<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tvb.simulator.models &mdash; The Virtual Brain 1.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="The Virtual Brain 1.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">The Virtual Brain 1.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for tvb.simulator.models</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#  TheVirtualBrain-Scientific Package. This package holds all simulators, and </span>
<span class="c"># analysers necessary to run brain-simulations. You can use it stand alone or</span>
<span class="c"># in conjunction with TheVirtualBrain-Framework Package. See content of the</span>
<span class="c"># documentation-folder for more details. See also http://www.thevirtualbrain.org</span>
<span class="c">#</span>
<span class="c"># (c) 2012-2013, Baycrest Centre for Geriatric Care (&quot;Baycrest&quot;)</span>
<span class="c">#</span>
<span class="c"># This program is free software; you can redistribute it and/or modify it under </span>
<span class="c"># the terms of the GNU General Public License version 2 as published by the Free</span>
<span class="c"># Software Foundation. This program is distributed in the hope that it will be</span>
<span class="c"># useful, but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public</span>
<span class="c"># License for more details. You should have received a copy of the GNU General </span>
<span class="c"># Public License along with this program; if not, you can download it here</span>
<span class="c"># http://www.gnu.org/licenses/old-licenses/gpl-2.0</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#   CITATION:</span>
<span class="c"># When using The Virtual Brain for scientific publications, please cite it as follows:</span>
<span class="c">#</span>
<span class="c">#   Paula Sanz Leon, Stuart A. Knock, M. Marmaduke Woodman, Lia Domide,</span>
<span class="c">#   Jochen Mersmann, Anthony R. McIntosh, Viktor Jirsa (2013)</span>
<span class="c">#       The Virtual Brain: a simulator of primate brain network dynamics.</span>
<span class="c">#   Frontiers in Neuroinformatics (7:10. doi: 10.3389/fninf.2013.00010)</span>
<span class="c">#</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A collection of neuronal dynamics models.</span>

<span class="sd">Specific models inherit from the abstract class Model, which in turn inherits</span>
<span class="sd">from the class Trait from the tvb.basic.traits module.</span>

<span class="sd">.. moduleauthor:: Stuart A. Knock &lt;Stuart@tvb.invalid&gt;</span>
<span class="sd">.. moduleauthor:: Paula Sanz Leon &lt;Paula@tvb.invalid&gt;</span>
<span class="sd">.. moduleauthor:: Gaurav Malhotra &lt;Gaurav@tvb.invalid&gt;</span>
<span class="sd">.. moduleauthor:: Marmaduke Woodman &lt;mw@eml.cc&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">numexpr</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapz</span> <span class="k">as</span> <span class="n">scipy_integrate_trapz</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span> <span class="k">as</span> <span class="n">scipy_stats_norm</span>
<span class="kn">from</span> <span class="nn">tvb.simulator.common</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">import</span> <span class="nn">tvb.datatypes.arrays</span> <span class="kn">as</span> <span class="nn">arrays</span>
<span class="kn">import</span> <span class="nn">tvb.datatypes.lookup_tables</span> <span class="kn">as</span> <span class="nn">lookup_tables</span>
<span class="kn">import</span> <span class="nn">tvb.basic.traits.core</span> <span class="kn">as</span> <span class="nn">core</span>
<span class="kn">import</span> <span class="nn">tvb.basic.traits.types_basic</span> <span class="kn">as</span> <span class="nn">basic</span>
<span class="kn">import</span> <span class="nn">tvb.simulator.noise</span> <span class="kn">as</span> <span class="nn">noise_module</span>


<span class="n">LOG</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="c">#TODO: For UI convinience set the step in all parameters ranges such that there</span>
<span class="c">#      are apporximately 10 steps from lo to hi...</span>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines the abstract class for neuronal models.</span>

<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: Model.__init__</span>
<span class="sd">    .. automethod:: Model.dfun</span>
<span class="sd">    .. automethod:: Model.update_derived_parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_base_classes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Model&#39;</span><span class="p">,</span> <span class="s">&quot;LileySteynRoss&quot;</span><span class="p">,</span> <span class="s">&quot;JansenRitDavid&quot;</span><span class="p">,</span> <span class="s">&quot;JRFast&quot;</span><span class="p">]</span>
    <span class="c">#NOTE: the parameters that are contained in the following list will be</span>
    <span class="c">#      editable from the ui in an visual manner</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">noise</span> <span class="o">=</span> <span class="n">noise_module</span><span class="o">.</span><span class="n">Noise</span><span class="p">(</span>
        <span class="n">fixed_type</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c">#Can only be Noise in UI, and not a subclass of Noise</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Initial Conditions Noise&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">noise_module</span><span class="o">.</span><span class="n">Noise</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;A noise source used to provide random initial conditions when</span>
<span class="s">        no, or insufficient, explicit initial conditions are provided. </span>
<span class="s">        NOTE: Dispersion is computed based on ``state_variable_range``.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">42</span> <span class="o">**</span> <span class="mi">42</span><span class="p">)</span> <span class="c">#NOTE: Hoping this order will always make it last...</span>


<div class="viewcode-block" id="Model.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Model.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the model with parameters as keywords arguments, a sensible</span>
<span class="sd">        default parameter set should be provided via the trait mechanism.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="c">#self._state_variables = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#NOTE: Models without modes can ignore this.</span>

</div>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_derived_parameters</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A formal, executable, representation of a Model object. &quot;&quot;&quot;</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">traited_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">formal</span> <span class="o">=</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="s">&quot;=</span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traited_kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;=</span><span class="si">%s</span><span class="s">)&quot;</span>
        <span class="k">return</span> <span class="n">formal</span> <span class="o">%</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;(self.&quot;</span> <span class="o">+</span> <span class="s">&quot;, self.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traited_kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; An informal, human readable, representation of a Model object. &quot;&quot;&quot;</span>
        <span class="c">#NOTE: We don&#39;t explicitly list kwds cause some models have too many.</span>
        <span class="n">informal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;(**kwargs)&quot;</span>
        <span class="k">return</span> <span class="n">informal</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of the state variables in this model. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">[</span><span class="s">&#39;variables_of_interest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">options</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nvar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of state variables in this model. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span>
        
        
<span class="c">#    @property</span>
<span class="c">#    def distal_coupling(self):</span>
<span class="c">#        &quot;&quot;&quot; Heterogeneous coupling given by the connectivity matrix&quot;&quot;&quot;</span>
<span class="c">#        return self._distal_coupling</span>
<span class="c">#        </span>
<span class="c">#    @property</span>
<span class="c">#    def local_coupling(self):</span>
<span class="c">#        &quot;&quot;&quot; Homogeneous connectivity given by a local connectivity kernel&quot;&quot;&quot;</span>
<span class="c">#        return self._local_coupling</span>
<span class="c">#        </span>
<span class="c">#    @property</span>
<span class="c">#    def internal_coupling(self):</span>
<span class="c">#        &quot;&quot;&quot; Internal connectivity between neural masses of a model&quot;&quot;&quot;</span>
<span class="c">#        return self._internal_coupling</span>
<span class="c">#        </span>
<span class="c">#    @property</span>
<span class="c">#    def state_coupling(self):</span>
<span class="c">#        &quot;&quot;&quot; State operator: A matrix where each elemeent represents a parameter of the model &quot;&quot;&quot;</span>
<span class="c">#        return self._state_coupling</span>
        

<div class="viewcode-block" id="Model.update_derived_parameters"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Model.update_derived_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_derived_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When needed, this should be a method for calculating parameters that are</span>
<span class="sd">        calculated based on paramaters directly set by the caller. For example, </span>
<span class="sd">        see, ReducedSetFitzHughNagumo. When not needed, this pass simplifies </span>
<span class="sd">        code that updates an arbitrary models parameters -- ie, this can be </span>
<span class="sd">        safely called on any model, whether it&#39;s used or not. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

</div>
    <span class="k">def</span> <span class="nf">configure_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Docs...&quot;&quot;&quot;</span>
        <span class="c">#Configure the models noise stream</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">ntau</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">configure_coloured</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># The same applies for truncated rv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">configure_white</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">history_shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines a set of sensible initial conditions, it is only expected that</span>
<span class="sd">        these initial conditions be guaranteed to be sensible for the default</span>
<span class="sd">        parameter set.</span>

<span class="sd">        It is often seen that initial conditions or initial history are filled</span>
<span class="sd">        following ic = nsig * noise + loc, where noise is a stream of random</span>
<span class="sd">        numbers drawn from a uniform or normal distribution.</span>

<span class="sd">        Here, the noise is integrated, that is the initial conditions are</span>
<span class="sd">        described by a diffusion process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#NOTE: The following max_history_length factor is set such that it</span>
        <span class="c">#considers the worst case possible for the history array, that is, low</span>
        <span class="c">#conduction speed and the longest white matter fibre. With this, plus</span>
        <span class="c">#drawing the random stream of numbers from a truncated normal</span>
        <span class="c">#distribution, we expect to bound the diffussion process used to set</span>
        <span class="c">#the initial history to the state variable ranges. (even for the case</span>
        <span class="c">#of rate based models)</span>

        <span class="c"># Example:</span>
        <span class="c">#        + longest fiber: 200 mm (Ref:)</span>
        <span class="c">#        + min conduction speed: 3 mm/ms (Ref: http://www.scholarpedia.org/article/Axonal_conduction_delays) </span>
        <span class="c">#          corpus callosum in the macaque monkey.</span>
        <span class="c">#        + max time delay: tau = longest fibre / speed \approx 67 ms</span>
        <span class="c">#        + let&#39;s hope for the best...</span>

        <span class="n">max_history_length</span> <span class="o">=</span> <span class="mf">67.</span> <span class="c"># ms</span>
        <span class="c">#TODO: There is an issue of allignment when the current implementation </span>
        <span class="c">#      is used to pad out explicit inital conditions that aren&#39;t as long</span>
        <span class="c">#      as the required history...</span>
        <span class="c">#TODO: We still ideally want to support spatial colour for surfaces --</span>
        <span class="c">#      though this will probably have to be done at the Simulator level</span>
        <span class="c">#      with a linear, strictly-stable, spatially invariant filter</span>
        <span class="c">#      defined on the mesh surface... and in a way that won&#39;t change the</span>
        <span class="c">#      temporal correllation structure... and I&#39;m also assuming that the</span>
        <span class="c">#      temporally coloured noise hasn&#39;t un-whitened the spatial noise</span>
        <span class="c">#      distribution to start with... [ie, spatial colour is a longer</span>
        <span class="c">#      term problem to solve...])</span>
        <span class="c">#TODO: Ideally we&#39;d like to have a independent random stream for each node.</span>
        <span class="c">#      Currently, if the number of nodes is different we&#39;ll get the</span>
        <span class="c">#      slightly different values further in the history array.</span>

        <span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">history_shape</span><span class="p">)</span>
        <span class="n">tpts</span> <span class="o">=</span> <span class="n">history_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nvar</span> <span class="o">=</span> <span class="n">history_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">history_shape</span> <span class="o">=</span> <span class="n">history_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_initial</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">history_shape</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tpts</span><span class="p">,</span> <span class="n">nvar</span><span class="p">)</span> <span class="o">+</span> <span class="n">history_shape</span><span class="p">)</span>
        <span class="n">nsig</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nvar</span><span class="p">)</span>
        <span class="n">loc</span>   <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nvar</span><span class="p">)</span>  

        <span class="k">for</span> <span class="n">tpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tpts</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvar</span><span class="p">):</span>
                <span class="n">loc</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span> 
                <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_history_length</span>

                <span class="c"># define lower und upper bounds to truncate the random variates to the sv range.</span>
                <span class="n">lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lo_bound</span><span class="p">,</span> <span class="n">up_bound</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">-</span> <span class="n">loc</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="o">/</span> <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">loc</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="o">/</span> <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                
                <span class="n">noise</span><span class="p">[</span><span class="n">tpt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">history_shape</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                                                         <span class="n">lo</span><span class="o">=</span><span class="n">lo_bound</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="n">up_bound</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvar</span><span class="p">):</span>
                <span class="c">#TODO: Hackery, validate me...-noise.mean(axis=0) ... self.noise.nsig</span>
            <span class="n">initial_conditions</span><span class="p">[:,</span> <span class="n">var</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">nsig</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">noise</span><span class="p">[:,</span> <span class="n">var</span><span class="p">,</span> <span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">loc</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">initial_conditions</span>


<div class="viewcode-block" id="Model.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Model.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the dynamic equations. That is, the derivative of the </span>
<span class="sd">        state-variables given their current state ``state_variables``, the past </span>
<span class="sd">        state from other regions of the brain currently arriving ``coupling``, </span>
<span class="sd">        and the current state of the &quot;local&quot; neighbourhood ``local_coupling``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
    <span class="k">def</span> <span class="nf">stationary_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">coupling</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">]]),</span>
                              <span class="n">initial_conditions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                              <span class="n">n_step</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_skip</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                              <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the state space trajectory of a single mass model system</span>
<span class="sd">        where coupling is static, with a deteministic Euler method. </span>

<span class="sd">        Models expect coupling of shape (n_cvar, n_node), so if this method</span>
<span class="sd">        is called with coupling (:, n_cvar, n_ode), it will compute a </span>
<span class="sd">        stationary trajectory for each coupling[i, ...]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">coupling</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">mapped</span><span class="p">(</span><span class="n">coupling_i</span><span class="p">):</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">initial_conditions</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">,</span>
                              <span class="n">n_step</span><span class="o">=</span><span class="n">n_step</span><span class="p">,</span> <span class="n">n_skip</span><span class="o">=</span><span class="n">n_skip</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                <span class="n">ts</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationary_trajectory</span><span class="p">(</span><span class="n">coupling_i</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ys</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">ys</span> <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ys</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">mapped</span><span class="p">,</span> <span class="n">coupling</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">initial_conditions</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">n_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nvar</span><span class="p">,</span> <span class="n">n_mode</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_variable_range</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_mode</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">lo</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_step</span><span class="p">):</span>
            <span class="n">state</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfun</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">coupling</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_skip</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dt</span> <span class="o">*</span> <span class="n">n_step</span><span class="p">:</span><span class="mi">1j</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        

<span class="c">#TODO: both coupling/connectivity and local_coupling should be generalised to </span>
<span class="c">#      couplings and local_couplings that can be set to independantly on each </span>
<span class="c">#      state variable of a model at run time. Current functionality would then </span>
<span class="c">#      come via defaults that turn off the coupling on some state variables. </span>

</div>
<div class="viewcode-block" id="model_device_info"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info">[docs]</a><span class="k">class</span> <span class="nc">model_device_info</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A model_device_info is a class that provides enough additional information, on</span>
<span class="sd">    request, in order to run the owner on a native code device, e.g. a CUDA</span>
<span class="sd">    GPU.</span>

<span class="sd">    All such device_data classes will need to furnish their corresponding </span>
<span class="sd">    global values as well as corresponding array arguments for update(.), </span>
<span class="sd">    already initialized based on the instance object that the device_data</span>
<span class="sd">    instance is attached to.</span>

<span class="sd">    Such things are built on conventions: a class should declare both</span>
<span class="sd">    a device_data attribute as well as class specific information, that is</span>
<span class="sd">    not programmatically available via traits. In general, each of the </span>
<span class="sd">    abstract classes (Model, Noise, Integrator &amp; Coupling) have n_xxpr</span>
<span class="sd">    and xxpr, but they don&#39;t have symmetric properties, so it will be done</span>
<span class="sd">    case by case.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="o">=</span><span class="p">[],</span> <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a model_device_info instance with a list of trait attributes</span>
<span class="sd">        corresponding to the mass model parameters, and a kernel which is</span>
<span class="sd">        a string of code required to implement the model&#39;s dfun on device.</span>

<span class="sd">        The order of the parameters MUST identify the order of the parameters</span>
<span class="sd">        in the array returned by the mmpr property and thus the order in</span>
<span class="sd">        which the parameters can be read via P(i) macro in the kernel code.</span>

<span class="sd">        Don&#39;t forget, the kernel code defines per node, per thread update.</span>

<span class="sd">        Unforunately, I did not forsee an obvious way to nicely handle modes in the</span>
<span class="sd">        reduced models. Kernel code must handle all variables as scalars.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pars</span> <span class="o">=</span> <span class="n">pars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span> <span class="o">=</span> <span class="n">kernel</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.n_mmpr"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.n_mmpr">[docs]</a>    <span class="k">def</span> <span class="nf">n_mmpr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pars</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># have to figure out default par size</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">__class__</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">device_info</span><span class="o">.</span><span class="n">_pars</span><span class="p">:</span>
                <span class="n">att</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">k</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">k</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="n">att</span><span class="o">.</span><span class="n">size</span>
            <span class="k">return</span> <span class="n">count</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.mmpr"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.mmpr">[docs]</a>    <span class="k">def</span> <span class="nf">mmpr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># build mmpr array from known inst traits</span>

        <span class="n">nm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">number_of_modes</span>
        <span class="k">if</span> <span class="n">nm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pars</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">par</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">par</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">par</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">name</span>
                <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c"># so self.mmpr[0] yield all pars for node 0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">__class__</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pars</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">k</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">k</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">name</span>
                <span class="n">att</span><span class="p">,</span> <span class="n">attnew</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">att</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">attnew</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">att</span><span class="o">.</span><span class="n">flat</span><span class="p">[:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="si">%r</span><span class="s">.</span><span class="si">%r</span><span class="s">.mmpr requires that modal models be initialized with</span>
<span class="s">                    spatially homogeneous pars, i.e. array([0.0]) not </span>
<span class="s">                    array([0.0, 0.1, ...]). Please set the per node parameters</span>
<span class="s">                    by hand, after configuring the device handler. Sorry.&quot;&quot;&quot;</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">pars</span><span class="p">)[</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.n_mode"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.n_mode">[docs]</a>    <span class="k">def</span> <span class="nf">n_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="s">&#39;number_of_modes&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.n_svar"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.n_svar">[docs]</a>    <span class="k">def</span> <span class="nf">n_svar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_mode</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.n_cvar"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.n_cvar">[docs]</a>    <span class="k">def</span> <span class="nf">n_cvar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">cvar</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_mode</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.cvar"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.cvar">[docs]</a>    <span class="k">def</span> <span class="nf">cvar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">cvar</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">cvar</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">cvar</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mode</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="model_device_info.kernel"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.model_device_info.kernel">[docs]</a>    <span class="k">def</span> <span class="nf">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span>
</div>
    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">ownr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="n">inst</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not to be set&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

</div>
<div class="viewcode-block" id="WilsonCowan"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.WilsonCowan">[docs]</a><span class="k">class</span> <span class="nc">WilsonCowan</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **References**:</span>

<span class="sd">    .. [WC_1972] Wilson, H.R. and Cowan, J.D. *Excitatory and inhibitory </span>
<span class="sd">        interactions in localized populations of model neurons*, Biophysical</span>
<span class="sd">        journal, 12: 1-24, 1972.</span>
<span class="sd">    .. [WC_1973] Wilson, H.R. and Cowan, J.D  *A Mathematical Theory of the </span>
<span class="sd">        Functional Dynamics of Cortical and Thalamic Nervous Tissue*</span>

<span class="sd">    Used Eqns 11 and 12 from [WC_1972]_ in ``dfun``.  P and Q represent external inputs,</span>
<span class="sd">    which when exploring the phase portrait of the local model are set to</span>
<span class="sd">    constant values. However in the case of a full network, P and Q are the</span>
<span class="sd">    entry point to our long range and local couplings, that is, the  activity</span>
<span class="sd">    from all other nodes is the external input to the local population.</span>

<span class="sd">    The default parameters are taken from figure 4 of [WC_1972]_, pag. 10</span>

<span class="sd">    In [WC_1973]_ they present a model of neural tissue on the pial surface is.</span>
<span class="sd">    See Fig. 1 in page 58. The following local couplings (lateral interactions)</span>
<span class="sd">    occur given a region i and a region j:</span>

<span class="sd">      E_i-&gt; E_j </span>
<span class="sd">      E_i-&gt; I_j </span>
<span class="sd">      I_i-&gt; I_j  </span>
<span class="sd">      I_i-&gt; E_j</span>
<span class="sd"> </span>

<span class="sd">    The models (:math:`E`, :math:`I`) phase-plane, including a representation of</span>
<span class="sd">    the vector field as well as its nullclines, using default parameters, can be</span>
<span class="sd">    seen below:</span>

<span class="sd">        .. _phase-plane-WC:</span>
<span class="sd">        .. figure :: img/WilsonCowan_01_mode_0_pplane.svg</span>
<span class="sd">            :alt: Wilson-Cowan phase plane (E, I)</span>

<span class="sd">            The (:math:`E`, :math:`I`) phase-plane for the Wilson-Cowan model.</span>

<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: WilsonCowan.__init__</span>
<span class="sd">    .. automethod:: WilsonCowan.dfun</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Wilson-Cowan model&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;c_1&#39;</span><span class="p">,</span> <span class="s">&#39;c_2&#39;</span><span class="p">,</span> <span class="s">&#39;c_3&#39;</span><span class="p">,</span> <span class="s">&#39;c_4&#39;</span><span class="p">,</span> <span class="s">&#39;tau_e&#39;</span><span class="p">,</span> <span class="s">&#39;tau_i&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;a_e&#39;</span><span class="p">,</span> <span class="s">&#39;theta_e&#39;</span><span class="p">,</span> <span class="s">&#39;a_i&#39;</span><span class="p">,</span> <span class="s">&#39;theta_i&#39;</span><span class="p">,</span> <span class="s">&#39;r_e&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;r_i&#39;</span><span class="p">,</span> <span class="s">&#39;k_e&#39;</span><span class="p">,</span> <span class="s">&#39;k_i&#39;</span><span class="p">,</span> <span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="s">&#39;Q&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">c_1</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c_1`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">11.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">16.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory to excitatory  coupling coefficient&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">c_2</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c_2`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory to excitatory coupling coefficient&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">c_3</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c_3`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">13.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">22.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory to inhibitory coupling coefficient.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">c_4</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c_4`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">11.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory to inhibitory coupling coefficient.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">tau_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory population, membrane time-constant [ms]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">tau_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory population, membrane time-constant [ms]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">a_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The slope parameter for the excitatory response function&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">theta_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\theta_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.8</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Position of the maximum slope of a sigmoid function [in</span>
<span class="s">        threshold units].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">a_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The slope parameter for the inhibitory response function&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">theta_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\theta_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Position of the maximum slope of a sigmoid function [in</span>
<span class="s">        threshold units]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">r_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`r_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory refractory period&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">r_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`r_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory refractory period&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">k_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`k_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum value of the excitatory response function&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">k_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`k_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum value of the inhibitory response function&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`k_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;External stimulus to the excitatory population. Constant intensity.Entry point for coupling.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`k_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;External stimulus to the inhibitory population. Constant intensity.Entry point for coupling.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>


    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;E&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span>
                 <span class="s">&quot;I&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 2.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0], dtype=numpy.int32),</span>
    <span class="c">#        doc = &quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`E = 0`</span>
    <span class="c">#        and :math:`I = 1`.&quot;&quot;&quot;,</span>
    <span class="c">#        order = 16)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;E&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`E = 0`</span>
<span class="s">                                    and :math:`I = 1`.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c">#    coupling_variables = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables to couple activity through&quot;,</span>
    <span class="c">#        default = numpy.array([0], dtype=numpy.int32))</span>

    <span class="c">#    nsig = arrays.FloatArray(</span>
    <span class="c">#        label = &quot;Noise dispersion&quot;,</span>
    <span class="c">#        default = numpy.array([0.0]),</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 1.0))</span>


<div class="viewcode-block" id="WilsonCowan.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.WilsonCowan.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the WilsonCowan model&#39;s traited attributes, any provided as</span>
<span class="sd">        keywords will overide their traited default.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: initing...&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WilsonCowan</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#self._state_variables = [&quot;E&quot;, &quot;I&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="WilsonCowan.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.WilsonCowan.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">        .. math::</span>
<span class="sd">            \tau \dot{x}(t) &amp;= -z(t) + \phi(z(t)) \\</span>
<span class="sd">            \phi(x) &amp;= \frac{c}{1-exp(-a (x-b))}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># long-range coupling</span>
        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># short-range (local) coupling</span>
        <span class="n">lc_0</span> <span class="o">=</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">E</span>
        <span class="n">lc_1</span> <span class="o">=</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">I</span> 

        <span class="n">x_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_1</span> <span class="o">*</span> <span class="n">E</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">+</span> <span class="mf">1.25</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">lc_0</span> <span class="o">+</span> <span class="n">lc_1</span>
        <span class="n">x_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_3</span> <span class="o">*</span> <span class="n">E</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_4</span> <span class="o">*</span> <span class="n">I</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">lc_0</span> <span class="o">+</span> <span class="n">lc_1</span>

        <span class="n">s_e</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_e</span><span class="p">)))</span>
        <span class="n">s_i</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_i</span><span class="p">)))</span>

        <span class="n">dE</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">E</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_e</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span> <span class="o">*</span> <span class="n">s_e</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">I</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_i</span> <span class="o">*</span> <span class="n">I</span><span class="p">)</span> <span class="o">*</span> <span class="n">s_i</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_i</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dE</span><span class="p">,</span> <span class="n">dI</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">derivative</span>

    <span class="c"># info for device_data</span></div>
    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>

        <span class="n">pars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;c_1&#39;</span><span class="p">,</span> <span class="s">&#39;c_2&#39;</span><span class="p">,</span> <span class="s">&#39;c_3&#39;</span><span class="p">,</span> <span class="s">&#39;c_4&#39;</span><span class="p">,</span> <span class="s">&#39;tau_e&#39;</span><span class="p">,</span> <span class="s">&#39;tau_i&#39;</span><span class="p">,</span> <span class="s">&#39;a_e&#39;</span><span class="p">,</span> <span class="s">&#39;theta_e&#39;</span><span class="p">,</span>
              <span class="s">&#39;a_i&#39;</span><span class="p">,</span> <span class="s">&#39;theta_i&#39;</span><span class="p">,</span> <span class="s">&#39;r_e&#39;</span><span class="p">,</span> <span class="s">&#39;r_i&#39;</span><span class="p">,</span> <span class="s">&#39;k_e&#39;</span><span class="p">,</span> <span class="s">&#39;k_i&#39;</span><span class="p">],</span>

        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        // read parameters</span>
<span class="s">        float c_1     = P(0)</span>
<span class="s">            , c_2     = P(1)</span>
<span class="s">            , c_3     = P(2)</span>
<span class="s">            , c_4     = P(3)</span>
<span class="s">            , tau_e   = P(4)</span>
<span class="s">            , tau_i   = P(5)</span>
<span class="s">            , a_e     = P(6)</span>
<span class="s">            , theta_e = P(7)</span>
<span class="s">            , a_i     = P(8)</span>
<span class="s">            , theta_i = P(9)</span>
<span class="s">            , r_e     = P(10)</span>
<span class="s">            , r_i     = P(11)</span>
<span class="s">            , k_e     = P(12)</span>
<span class="s">            , k_i     = P(13)</span>

<span class="s">        // state variables</span>
<span class="s">            , e = X(0)</span>
<span class="s">            , i = X(1)</span>

<span class="s">        // aux variables</span>
<span class="s">            , c_0 = I(0)</span>

<span class="s">            , x_e = c_1 * e - c_2 * i + c_0</span>
<span class="s">            , x_i = c_3 * e - c_4 * i</span>

<span class="s">            , s_e = 1.0 / (1.0 + exp(-a_e * (x_e - theta_e)))</span>
<span class="s">            , s_i = 1.0 / (1.0 + exp(-a_i * (x_i - theta_i)));</span>

<span class="s">        // set derivatives</span>
<span class="s">        DX(0) = (-e + (k_e - r_e * e) * s_e) / tau_e;</span>
<span class="s">        DX(1) = (-i + (k_i - r_i * i) * s_i) / tau_e;</span>
<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="ReducedSetFitzHughNagumo"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetFitzHughNagumo">[docs]</a><span class="k">class</span> <span class="nc">ReducedSetFitzHughNagumo</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    A reduced representation of a set of Fitz-Hugh Nagumo oscillators,</span>
<span class="sd">    [SJ_2008]_.</span>

<span class="sd">    The models (:math:`\xi`, :math:`\eta`) phase-plane, including a </span>
<span class="sd">    representation of the vector field as well as its nullclines, using default</span>
<span class="sd">    parameters, can be seen below:</span>

<span class="sd">        .. _phase-plane-rFHN_0:</span>
<span class="sd">        .. figure :: img/ReducedSetFitzHughNagumo_01_mode_0_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 1st mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the first mode of</span>
<span class="sd">            a reduced set of Fitz-Hugh Nagumo oscillators.</span>

<span class="sd">        .. _phase-plane-rFHN_1:</span>
<span class="sd">        .. figure :: img/ReducedSetFitzHughNagumo_01_mode_1_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 2nd mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the second mode of</span>
<span class="sd">            a reduced set of Fitz-Hugh Nagumo oscillators.</span>

<span class="sd">        .. _phase-plane-rFHN_2:</span>
<span class="sd">        .. figure :: img/ReducedSetFitzHughNagumo_01_mode_2_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 3rd mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the third mode of</span>
<span class="sd">            a reduced set of Fitz-Hugh Nagumo oscillators.</span>


<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: ReducedSetFitzHughNagumo.__init__</span>
<span class="sd">    .. automethod:: ReducedSetFitzHughNagumo.dfun</span>
<span class="sd">    .. automethod:: ReducedSetFitzHughNagumo.update_derived_parameters</span>

<span class="sd">    #NOTE: In the Article this modelis called StefanescuJirsa2D</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Stefanescu-Jirsa 2D&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;K11&#39;</span><span class="p">,</span> <span class="s">&#39;K12&#39;</span><span class="p">,</span> <span class="s">&#39;K21&#39;</span><span class="p">,</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;mu&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;doc...(prob something about timescale seperation)&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.45</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;doc...&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.9</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;doc...&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">K11</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{11}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, excitatory to excitatory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">K12</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{12}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, excitatory to inhibitory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">K21</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{21}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, inhibitory to excitatory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\sigma`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.35</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Standard deviation of Gaussian distribution&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\mu`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Mean of Gaussian distribution&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;xi&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]),</span>
                 <span class="s">&quot;eta&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),</span>
                 <span class="s">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]),</span>
                 <span class="s">&quot;beta&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 4.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0, 2], dtype=numpy.int32),</span>
    <span class="c">#        doc = r&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`\xi = 0`,</span>
    <span class="c">#        :math:`\eta = 1`, :math:`\alpha = 2`, and :math:`\beta= 3`.&quot;&quot;&quot;,</span>
    <span class="c">#        order = 10)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;xi&quot;</span><span class="p">,</span> <span class="s">&quot;eta&quot;</span><span class="p">,</span> <span class="s">&quot;alpha&quot;</span><span class="p">,</span> <span class="s">&quot;beta&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;xi&quot;</span><span class="p">,</span> <span class="s">&quot;alpha&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">r&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`\xi = 0`,</span>
<span class="s">                                    :math:`\eta = 1`, :math:`\alpha = 2`, and :math:`\beta= 3`.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c">#    number_of_modes = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;Number of modes&quot;,</span>
    <span class="c">#        default = 3)</span>
    <span class="c">#</span>
    <span class="c">#    nu = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;nu&quot;,</span>
    <span class="c">#        default = 1500,</span>
    <span class="c">#        range = basic.Range(lo = 0, hi = 10000, step = 100),</span>
    <span class="c">#        doc = &quot;&quot;&quot;Discretisation of Inhibitory distribution&quot;&quot;&quot;)</span>
    <span class="c">#</span>
    <span class="c">#    nv = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;nv&quot;,</span>
    <span class="c">#        default = 1500,</span>
    <span class="c">#        range = basic.Range(lo = 0, hi = 10000, step = 100),</span>
    <span class="c">#        doc = &quot;&quot;&quot;Discretisation of Excitatory distribution&quot;&quot;&quot;)</span>

    <span class="c">#    coupling_variables = trait.Array(</span>
    <span class="c">#        label = &quot;Variables to couple activity through&quot;,</span>
    <span class="c">#        default = numpy.array([0, 2], dtype=numpy.int32))</span>

    <span class="c">#    nsig = trait.Array(label = &quot;Noise dispersion&quot;,</span>
    <span class="c">#                       default = numpy.array([0.0]))</span>


<div class="viewcode-block" id="ReducedSetFitzHughNagumo.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetFitzHughNagumo.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise parameters for a reduced representation of a set of</span>
<span class="sd">        Fitz-Hugh Nagumo oscillators.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedSetFitzHughNagumo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#self._state_variables = [&quot;xi&quot;, &quot;eta&quot;, &quot;alpha&quot;, &quot;beta&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="c">#TODO: Hack fix, these cause issues with mapping spatialised parameters </span>
        <span class="c">#      at the region level to the surface for surface sims.</span>
        <span class="c">#NOTE: Existing modes definition (from the paper) is not properly </span>
        <span class="c">#      normalised, so number_of_modes can&#39;t really be changed</span>
        <span class="c">#      meaningfully anyway adnd nu and nv just need to be &quot;large enough&quot;</span>
        <span class="c">#      so chaning them is only really an optimisation thing...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mi">15000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">=</span> <span class="mi">15000</span>

        <span class="c">#Derived parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span> <span class="o">=</span> <span class="bp">None</span>

</div>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedSetFitzHughNagumo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s">&quot;nv must be divisible by the number_of_modes: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s">&quot;nu must be divisible by the number_of_modes: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_derived_parameters</span><span class="p">()</span>


<div class="viewcode-block" id="ReducedSetFitzHughNagumo.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetFitzHughNagumo.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">        .. math::</span>
<span class="sd">            \dot{\xi}_i &amp;= </span>
<span class="sd">                c\left(\xi_i-e_i\frac{\xi_i^3}{3}-\eta_i\right) +</span>
<span class="sd">                K_{11}\left[\sum_{k=1}^{3} A_{ik}\xi_k-\xi_i\right] -</span>
<span class="sd">                K_{12}\left[\sum_{k=1}^{3} B_{ik}\alpha_k-\xi_i\right] +</span>
<span class="sd">                cIE_i \\</span>
<span class="sd">            \dot{\eta}_i &amp;=</span>
<span class="sd">                \frac{1}{c}\left(\xi_i-b\eta_i+m_i\right) \\</span>
<span class="sd">            \dot{\alpha}_i &amp;=</span>
<span class="sd">                c\left(\alpha_i-f_i\frac{\alpha_i^3}{3}-\beta_i\right) +</span>
<span class="sd">                K_{21}\left[\sum_{k=1}^{3} C_{ik}\xi_i-\alpha_i\right] +</span>
<span class="sd">                cII_i \\</span>
<span class="sd">            \dot{\beta}_i &amp;= \frac{1}{c}\left(\alpha_i-b\beta_i+n_i\right)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xi</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># sum the activity from the modes</span>
        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="c">#TODO: generalize coupling variables to a matrix form </span>
        <span class="c">#c_1 = coupling[1, :] # this cv represents alpha</span>

        <span class="n">dxi</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">K11</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aik</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">-</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">K12</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bik</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">+</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">xi</span><span class="p">))</span>

        <span class="n">deta</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span>

        <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">K21</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cik</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">))</span>

        <span class="n">dbeta</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dxi</span><span class="p">,</span> <span class="n">deta</span><span class="p">,</span> <span class="n">dalpha</span><span class="p">,</span> <span class="n">dbeta</span><span class="p">])</span>
        <span class="c">#import pdb; pdb.set_trace()</span>
        <span class="k">return</span> <span class="n">derivative</span>

</div>
<div class="viewcode-block" id="ReducedSetFitzHughNagumo.update_derived_parameters"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetFitzHughNagumo.update_derived_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_derived_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate coefficients for the Reduced FitzHugh-Nagumo oscillator based</span>
<span class="sd">        neural field model. Specifically, this method implements equations for</span>
<span class="sd">        calculating coefficients found in the supplemental material of</span>
<span class="sd">        [SJ_2008]_.</span>

<span class="sd">        Include equations here...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newaxis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span>
        <span class="n">trapz</span> <span class="o">=</span> <span class="n">scipy_integrate_trapz</span>

        <span class="n">stepu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stepv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">scipy_stats_norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>

        <span class="n">Zu</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stepu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">stepu</span><span class="p">))</span>
        <span class="n">Zv</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stepv</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">stepv</span><span class="p">))</span>

        <span class="c"># Define the modes</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>

        <span class="n">nv_per_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span>
        <span class="n">nu_per_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nv_per_mode</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nv_per_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nv_per_mode</span><span class="p">)</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nu_per_mode</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nu_per_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nu_per_mode</span><span class="p">)</span>

        <span class="c"># Normalise the modes</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">V</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">Zv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">U</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">U</span> <span class="o">*</span> <span class="n">U</span><span class="p">,</span> <span class="n">Zu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="c"># Get Normal PDF&#39;s evaluated with sampling Zv and Zu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">Zv</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">Zu</span><span class="p">)</span>
        <span class="n">G1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">G2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">cV</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="n">cU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>

        <span class="n">intcVdZ</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cV</span><span class="p">,</span> <span class="n">Zv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">newaxis</span><span class="p">]</span>
        <span class="n">intG1VdZ</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">G1</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">Zv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">intcUdZ</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cU</span><span class="p">,</span> <span class="n">Zu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#import pdb; pdb.set_trace()</span>
        <span class="c">#Calculate coefficients </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcVdZ</span><span class="p">,</span> <span class="n">intG1VdZ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcVdZ</span><span class="p">,</span> <span class="n">trapz</span><span class="p">(</span><span class="n">G2</span> <span class="o">*</span> <span class="n">U</span><span class="p">,</span> <span class="n">Zu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcUdZ</span><span class="p">,</span> <span class="n">intG1VdZ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cV</span> <span class="o">*</span> <span class="n">V</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Zv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cU</span> <span class="o">*</span> <span class="n">U</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Zu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Zv</span> <span class="o">*</span> <span class="n">cV</span><span class="p">,</span> <span class="n">Zv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Zu</span> <span class="o">*</span> <span class="n">cU</span><span class="p">,</span> <span class="n">Zu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">intcVdZ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">intcUdZ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c">#import pdb; pdb.set_trace()</span>

    <span class="c"># DRAGONS BE HERE</span></div>
    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>
        <span class="n">pars</span><span class="o">=</span><span class="p">[</span>
            <span class="c"># given parameters</span>
            <span class="s">&#39;tau&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;K11&#39;</span><span class="p">,</span> <span class="s">&#39;K12&#39;</span><span class="p">,</span> <span class="s">&#39;K21&#39;</span><span class="p">,</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">,</span>

            <span class="c"># derived parameters</span>
            <span class="s">&#39;Aik&#39;</span><span class="p">,</span> <span class="s">&#39;Bik&#39;</span><span class="p">,</span> <span class="s">&#39;Cik&#39;</span><span class="p">,</span> <span class="s">&#39;e_i&#39;</span><span class="p">,</span> <span class="s">&#39;f_i&#39;</span><span class="p">,</span> <span class="s">&#39;IE_i&#39;</span><span class="p">,</span> <span class="s">&#39;II_i&#39;</span><span class="p">,</span> <span class="s">&#39;m_i&#39;</span><span class="p">,</span> <span class="s">&#39;n_i&#39;</span>
        <span class="p">],</span>

        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        // read given parameters</span>

<span class="s">        float tau   = P(0)</span>
<span class="s">            , a     = P(1)</span>
<span class="s">            , b     = P(2)</span>
<span class="s">            , K11   = P(3)</span>
<span class="s">            , K12   = P(4)</span>
<span class="s">            , K21   = P(5)</span>
<span class="s">            , sigma = P(6)</span>
<span class="s">            , mu    = P(7)</span>

<span class="s">        // modal derived par macros</span>
<span class="s">#define A(i,k) P((8 + 0*9 + 3*(i) + (k)))</span>
<span class="s">#define B(i,k) P((8 + 1*9 + 3*(i) + (k)))</span>
<span class="s">#define C(i,k) P((8 + 2*9 + 3*(i) + (k)))</span>

<span class="s">#define E(i)   P((8 + 3*9 + 3*0 + (i)))</span>
<span class="s">#define F(i)   P((8 + 3*9 + 3*1 + (i)))</span>
<span class="s">#define IE(i)  P((8 + 3*9 + 3*2 + (i)))</span>
<span class="s">#define II(i)  P((8 + 3*9 + 3*3 + (i)))</span>
<span class="s">#define M(i)   P((8 + 3*9 + 3*4 + (i)))</span>
<span class="s">#define N(i)   P((8 + 3*9 + 3*5 + (i)))</span>

<span class="s">        // state variables macros</span>
<span class="s">#define XI(i) X((0*n_mode + (i)))</span>
<span class="s">#define ETA(i) X((1*n_mode + (i)))</span>
<span class="s">#define ALPHA(i) X((2*n_mode + (i)))</span>
<span class="s">#define BETA(i) X((3*n_mode + (i)))</span>

<span class="s">        // aux variables</span>

<span class="s">            , c_0 = I(0)</span>
<span class="s">            , c_1 = I(1) /* ---&gt;&gt;&gt;&gt;&gt;&gt;&gt; */ ; /* &lt;&lt;&lt;-------- extremely important semicolon */</span>

<span class="s">        // nothing else but the dot product of the modal interaction coefficients with the instantanoneous state</span>
<span class="s">#define XI_dot_A(k) (XI(1)*A(1, (k)) + XI(2)*A(2, (k)) + XI(3)*A(3, (k)))</span>
<span class="s">#define XI_dot_C(k) (XI(1)*C(1, (k)) + XI(2)*C(2, (k)) + XI(3)*C(3, (k)))</span>
<span class="s">#define ALPHA_dot_B(k) (ALPHA(1)*B(1, (k)) + ALPHA(2)*B(2, (k)) + ALPHA(3)*B(3, (k)))</span>

<span class="s">        // derivatives</span>
<span class="s">        for (int i=0; i&lt;n_mode; i++)</span>
<span class="s">        {</span>
<span class="s">            DX(n_mode*0 + i) = (tau * (XI(i) - E(i)*XI(i)*XI(i)*XI(i)/3.0 - ETA(i)) + </span><span class="se">\</span>
<span class="s">                                K11 * (XI_dot_A(i) - XI(i)) - </span><span class="se">\</span>
<span class="s">                                K12 * (ALPHA_dot_B(i) - XI(i)) + </span><span class="se">\</span>
<span class="s">                                tau * (IE(i) + c_0));</span>

<span class="s">            DX(n_mode*1 + i) = (XI(i) - b*ETA(i) + M(i)) / tau;</span>

<span class="s">            DX(n_mode*2 + i) = (tau * (ALPHA(i) - F(i)*ALPHA(i)*ALPHA(i)*ALPHA(i)/3.0 - BETA(i)) + </span><span class="se">\</span>
<span class="s">                                K21 * (XI_dot_C(i) - ALPHA(i)) + </span><span class="se">\</span>
<span class="s">                                tau * (II(i) + c_1));</span>

<span class="s">            DX(n_mode*3 + i) = (ALPHA(i) - b*BETA(i) + N(i)) / tau;</span>
<span class="s">        }</span>

<span class="s">        // clean up</span>
<span class="s">#undef A</span>
<span class="s">#undef B</span>
<span class="s">#undef C</span>
<span class="s">#undef E</span>
<span class="s">#undef F</span>
<span class="s">#undef IE</span>
<span class="s">#undef II</span>
<span class="s">#undef M</span>
<span class="s">#undef N</span>
<span class="s">#undef XI</span>
<span class="s">#undef ETA</span>
<span class="s">#undef ALPHA</span>
<span class="s">#undef BETA</span>
<span class="s">#undef XI_dot_A</span>
<span class="s">#undef XI_dot_C</span>
<span class="s">#undef ALPHA_dot_B</span>
<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="ReducedSetHindmarshRose"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetHindmarshRose">[docs]</a><span class="k">class</span> <span class="nc">ReducedSetHindmarshRose</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    .. [SJ_2008] Stefanescu and Jirsa, PLoS Computational Biology, *A Low</span>
<span class="sd">        Dimensional Description of Globally Coupled Heterogeneous Neural</span>
<span class="sd">        Networks of Excitatory and Inhibitory*  4, 11, 26--36, 2008.</span>

<span class="sd">    The models (:math:`\xi`, :math:`\eta`) phase-plane, including a </span>
<span class="sd">    representation of the vector field as well as its nullclines, using default</span>
<span class="sd">    parameters, can be seen below:</span>

<span class="sd">        .. _phase-plane-rHR_0:</span>
<span class="sd">        .. figure :: img/ReducedSetHindmarshRose_01_mode_0_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 1st mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the first mode of</span>
<span class="sd">            a reduced set of Hindmarsh-Rose oscillators.</span>

<span class="sd">        .. _phase-plane-rHR_1:</span>
<span class="sd">        .. figure :: img/ReducedSetHindmarshRose_01_mode_1_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 2nd mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the second mode of </span>
<span class="sd">            a reduced set of Hindmarsh-Rose oscillators.</span>

<span class="sd">        .. _phase-plane-rHR_2:</span>
<span class="sd">        .. figure :: img/ReducedSetHindmarshRose_01_mode_2_pplane.svg</span>
<span class="sd">            :alt: Reduced set of FitzHughNagumo phase plane (xi, eta), 3rd mode.</span>

<span class="sd">            The (:math:`\xi`, :math:`\eta`) phase-plane for the third mode of</span>
<span class="sd">            a reduced set of Hindmarsh-Rose oscillators.</span>

<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: ReducedSetHindmarshRose.__init__</span>
<span class="sd">    .. automethod:: ReducedSetHindmarshRose.dfun</span>
<span class="sd">    .. automethod:: ReducedSetHindmarshRose.update_derived_parameters</span>
<span class="sd">    </span>
<span class="sd">    #NOTE: In the Article this modelis called StefanescuJirsa3D</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Stefanescu-Jirsa 3D&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;xo&#39;</span><span class="p">,</span> <span class="s">&#39;K11&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;K12&#39;</span><span class="p">,</span> <span class="s">&#39;K21&#39;</span><span class="p">,</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`r`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.006</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Adaptation parameter&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Dimensionless parameter as in the Hindmarsh-Rose model&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Dimensionless parameter as in the Hindmarsh-Rose model&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Dimensionless parameter as in the Hindmarsh-Rose model&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`d`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Dimensionless parameter as in the Hindmarsh-Rose model&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`s`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Adaptation paramters, governs feedback&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">xo</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`x_{o}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.6</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Leftmost equilibrium point of x&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">K11</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{11}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, excitatory to excitatory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">K12</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{12}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, excitatory to inhibitory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">K21</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`K_{21}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Internal coupling, inhibitory to excitatory&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\sigma`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Standard deviation of Gaussian distribution&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\mu`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.2</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">3.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Mean of Gaussian distribution&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;xi&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]),</span>
                 <span class="s">&quot;eta&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">]),</span>
                 <span class="s">&quot;tau&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]),</span>
                 <span class="s">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]),</span>
                 <span class="s">&quot;beta&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">]),</span>
                 <span class="s">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;xi&quot;</span><span class="p">,</span> <span class="s">&quot;eta&quot;</span><span class="p">,</span> <span class="s">&quot;tau&quot;</span><span class="p">,</span> <span class="s">&quot;alpha&quot;</span><span class="p">,</span> <span class="s">&quot;beta&quot;</span><span class="p">,</span> <span class="s">&quot;gamma&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;xi&quot;</span><span class="p">,</span> <span class="s">&quot;eta&quot;</span><span class="p">,</span> <span class="s">&quot;tau&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">r&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`\xi = 0`,</span>
<span class="s">                                    :math:`\eta = 1`, :math:`\tau = 2`, :math:`\alpha = 3`,</span>
<span class="s">                                    :math:`\beta = 4`, and :math:`\gamma = 5`&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 6.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0, 3], dtype=numpy.int32),</span>
    <span class="c">#        doc = r&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`\xi = 0`,</span>
    <span class="c">#        :math:`\eta = 1`, :math:`\tau = 2`, :math:`\alpha = 3`,</span>
    <span class="c">#        :math:`\beta = 4`, and :math:`\gamma = 5`&quot;&quot;&quot;,</span>
    <span class="c">#        order = 14)</span>

    <span class="c">#    number_of_modes = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;Number of modes&quot;,</span>
    <span class="c">#        default = 3,</span>
    <span class="c">#        doc = &quot;&quot;&quot;Number of modes&quot;&quot;&quot;)</span>
    <span class="c">#</span>
    <span class="c">#    nu = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;nu&quot;,</span>
    <span class="c">#        default = 1500,</span>
    <span class="c">#        range = basic.Range(lo = 500, hi = 10000, step = 500),</span>
    <span class="c">#        doc = &quot;&quot;&quot;Discretisation of Inhibitory distribution&quot;&quot;&quot;)</span>
    <span class="c">#</span>
    <span class="c">#    nv = Integer(</span>
    <span class="c">#        order = -1, #-1 =&gt; don&#39;t show me as a configurable option in the UI...</span>
    <span class="c">#        label = &quot;nv&quot;,</span>
    <span class="c">#        default = 1500,</span>
    <span class="c">#        range = basic.Range(lo = 500, hi = 10000, step = 500),</span>
    <span class="c">#        doc = &quot;&quot;&quot;Discretisation of Excitatory distribution&quot;&quot;&quot;)</span>

    <span class="c">#    coupling_variables = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables to couple activity through&quot;,</span>
    <span class="c">#        default = numpy.array([0, 3], dtype=numpy.int32))</span>

    <span class="c">#    nsig = arrays.FloatArray(label = &quot;Noise dispersion&quot;,</span>
    <span class="c">#                       default = numpy.array([0.0]))</span>


<div class="viewcode-block" id="ReducedSetHindmarshRose.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetHindmarshRose.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise parameters for a reduced representation of a set of</span>
<span class="sd">        Hindmarsh Rose oscillators, [SJ_2008]_.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedSetHindmarshRose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#self._state_variables = [&quot;xi&quot;, &quot;eta&quot;, &quot;tau&quot;, &quot;alpha&quot;, &quot;beta&quot;, &quot;gamma&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="c">#TODO: Hack fix, these cause issues with mapping spatialised parameters </span>
        <span class="c">#      at the region level to the surface for surface sims.</span>
        <span class="c">#NOTE: Existing modes definition (from the paper) is not properly </span>
        <span class="c">#      normalised, so number_of_modes can&#39;t really be changed</span>
        <span class="c">#      meaningfully anyway adnd nu and nv just need to be &quot;large enough&quot;</span>
        <span class="c">#      so chaning them is only really an optimisation thing...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mi">1500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">=</span> <span class="mi">1500</span>

        <span class="c">#derived parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A_ik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_ik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_ik</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span> <span class="o">=</span> <span class="bp">None</span>

</div>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedSetHindmarshRose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s">&quot;nv must be divisible by the number_of_modes: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s">&quot;nu must be divisible by the number_of_modes: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_derived_parameters</span><span class="p">()</span>


<div class="viewcode-block" id="ReducedSetHindmarshRose.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetHindmarshRose.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        The dynamic equations were taken from [SJ_2008]_, ...</span>

<span class="sd">        .. math::</span>
<span class="sd">            \dot{\xi}_i &amp;= \eta_i - a_i\xi_i^3 + b_i\xi_i^2 -</span>
<span class="sd">                             \tau_i + K_{11} \left[\sum_{k=1}^{3} A_{ik} \xi_k -</span>
<span class="sd">                             \xi_i \right] - K_{12} \left[\sum_{k=1}^{3} B_{ik} \alpha_k -</span>
<span class="sd">                             \xi_i\right] + IE_i \\</span>
<span class="sd">            \dot{\eta}_i &amp;= c_i-d_i\xi_i^2-\eta_i \\</span>
<span class="sd">            \dot{\tau}_i &amp;= rs\xi_i-r\tau_i-m_i \\</span>
<span class="sd">            \dot{\alpha}_i &amp;= \beta_i - e_i \alpha_i^3 +</span>
<span class="sd">                                f_i \alpha_i^2 - \gamma_i +</span>
<span class="sd">                                K_{21} \left[\sum_{k=1}^{3} C_{ik} \xi_k -</span>
<span class="sd">                                \alpha_i \right] + II_i \\</span>
<span class="sd">            \dot{\beta}_i &amp;= h_i - p_i \alpha_i^2 - \beta_i \\</span>
<span class="sd">            \dot{\gamma}_i &amp;= rs \alpha_i - r \gamma_i - n_i</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xi</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#c_1 = coupling[1, :]</span>

        <span class="n">dxi</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_i</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_i</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">tau</span> <span class="o">+</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">K11</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_ik</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">-</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">K12</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B_ik</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">+</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">xi</span><span class="p">)</span>

        <span class="n">deta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_i</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">eta</span>

        <span class="n">dtau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">tau</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span>

        <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">gamma</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">K21</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_ik</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">+</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>

        <span class="n">dbeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_i</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">beta</span>

        <span class="n">dgamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dxi</span><span class="p">,</span> <span class="n">deta</span><span class="p">,</span> <span class="n">dtau</span><span class="p">,</span> <span class="n">dalpha</span><span class="p">,</span> <span class="n">dbeta</span><span class="p">,</span> <span class="n">dgamma</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">derivative</span>

</div>
<div class="viewcode-block" id="ReducedSetHindmarshRose.update_derived_parameters"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedSetHindmarshRose.update_derived_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_derived_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate coefficients for the neural field model based on a Reduced set</span>
<span class="sd">        of Hindmarsh-Rose oscillators. Specifically, this method implements</span>
<span class="sd">        equations for calculating coefficients found in the supplemental</span>
<span class="sd">        material of [SJ_2008]_.</span>

<span class="sd">        Include equations here...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newaxis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span>
        <span class="n">trapz</span> <span class="o">=</span> <span class="n">scipy_integrate_trapz</span>

        <span class="n">stepu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stepv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">scipy_stats_norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>

        <span class="n">Iu</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stepu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">stepu</span><span class="p">))</span>
        <span class="n">Iv</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stepv</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">stepv</span><span class="p">))</span>

        <span class="c"># Define the modes</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>

        <span class="n">nv_per_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span>
        <span class="n">nu_per_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">):</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nv_per_mode</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nv_per_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nv_per_mode</span><span class="p">)</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nu_per_mode</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nu_per_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nu_per_mode</span><span class="p">)</span>

        <span class="c"># Normalise the modes</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">V</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">U</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">U</span> <span class="o">*</span> <span class="n">U</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="c"># Get Normal PDF&#39;s evaluated with sampling Zv and Zu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">Iv</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">Iu</span><span class="p">)</span>
        <span class="n">G1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">G2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">cV</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="n">cU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>

        <span class="c">#import pdb; pdb.set_trace()</span>
        <span class="n">intcVdI</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cV</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">newaxis</span><span class="p">]</span>
        <span class="n">intG1VdI</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">G1</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">intcUdI</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cU</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">newaxis</span><span class="p">]</span>

        <span class="c">#Calculate coefficients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A_ik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcVdI</span><span class="p">,</span> <span class="n">intG1VdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_ik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcVdI</span><span class="p">,</span> <span class="n">trapz</span><span class="p">(</span><span class="n">G2</span> <span class="o">*</span> <span class="n">U</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_ik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">intcUdI</span><span class="p">,</span> <span class="n">intG1VdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cV</span> <span class="o">*</span> <span class="n">V</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cU</span> <span class="o">*</span> <span class="n">U</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cV</span> <span class="o">*</span> <span class="n">V</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">trapz</span><span class="p">(</span><span class="n">cU</span> <span class="o">*</span> <span class="n">U</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">intcVdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">intcUdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IE_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Iv</span> <span class="o">*</span> <span class="n">cV</span><span class="p">,</span> <span class="n">Iv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">II_i</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Iu</span> <span class="o">*</span> <span class="n">cU</span><span class="p">,</span> <span class="n">Iu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">intcVdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">intcUdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xo</span> <span class="o">*</span> <span class="n">intcVdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xo</span> <span class="o">*</span> <span class="n">intcUdI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c"># DRAGONS BE HERE</span></div>
    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>
        <span class="n">pars</span><span class="o">=</span><span class="p">[</span>
            <span class="c"># given parameters</span>
            <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;xo&#39;</span><span class="p">,</span> <span class="s">&#39;K11&#39;</span><span class="p">,</span> <span class="s">&#39;K12&#39;</span><span class="p">,</span> <span class="s">&#39;K21&#39;</span><span class="p">,</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">,</span>
            <span class="c"># derived parameters</span>
            <span class="s">&#39;A_ik&#39;</span><span class="p">,</span> <span class="s">&#39;B_ik&#39;</span><span class="p">,</span> <span class="s">&#39;C_ik&#39;</span><span class="p">,</span> <span class="s">&#39;a_i&#39;</span><span class="p">,</span> <span class="s">&#39;b_i&#39;</span><span class="p">,</span> <span class="s">&#39;c_i&#39;</span><span class="p">,</span> <span class="s">&#39;d_i&#39;</span><span class="p">,</span> <span class="s">&#39;e_i&#39;</span><span class="p">,</span>
            <span class="s">&#39;f_i&#39;</span><span class="p">,</span> <span class="s">&#39;h_i&#39;</span><span class="p">,</span> <span class="s">&#39;p_i&#39;</span><span class="p">,</span> <span class="s">&#39;IE_i&#39;</span><span class="p">,</span> <span class="s">&#39;II_i&#39;</span><span class="p">,</span> <span class="s">&#39;m_i&#39;</span><span class="p">,</span> <span class="s">&#39;n_i&#39;</span><span class="p">],</span>


        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        // read given parameters</span>

<span class="s">        float r     = P(0)</span>
<span class="s">            , a     = P(1)</span>
<span class="s">            , b     = P(2)</span>
<span class="s">            , c     = P(3)</span>
<span class="s">            , d     = P(4)</span>
<span class="s">            , s     = P(5)</span>
<span class="s">            , xo    = P(6)</span>
<span class="s">            , K11   = P(7)</span>
<span class="s">            , K12   = P(8)</span>
<span class="s">            , K21   = P(9)</span>
<span class="s">            , sigma = P(10)</span>
<span class="s">            , mu    = P(11)</span>

<span class="s">        // modal derived par macros (mX is X_ik, vX is x_i (sorry))</span>
<span class="s">#define mA(i, k) P((12 + 0*9 + 3*(i) + (k)))</span>
<span class="s">#define mB(i, k) P((12 + 1*9 + 3*(i) + (k)))</span>
<span class="s">#define mC(i, k) P((12 + 2*9 + 3*(i) + (k)))</span>

<span class="s">#define vA(i)    P((12 + 3*9 + 3*0 + (i)))</span>
<span class="s">#define vB(i)    P((12 + 3*9 + 3*1 + (i)))</span>
<span class="s">#define vC(i)    P((12 + 3*9 + 3*2 + (i)))</span>
<span class="s">#define vD(i)    P((12 + 3*9 + 3*3 + (i)))</span>
<span class="s">#define vE(i)    P((12 + 3*9 + 3*4 + (i)))</span>
<span class="s">#define vF(i)    P((12 + 3*9 + 3*5 + (i)))</span>
<span class="s">#define vH(i)    P((12 + 3*9 + 3*6 + (i)))</span>
<span class="s">#define vP(i)    P((12 + 3*9 + 3*7 + (i)))</span>
<span class="s">#define vIE(i)   P((12 + 3*9 + 3*8 + (i)))</span>
<span class="s">#define vII(i)   P((12 + 3*9 + 3*9 + (i)))</span>
<span class="s">#define vM(i)    P((12 + 3*9 + 3*10 + (i)))</span>
<span class="s">#define vN(i)    P((12 + 3*9 + 3*11 + (i)))</span>

<span class="s">        // state variable macros</span>
<span class="s">#define XI(i)    X((0*n_mode + (i)))</span>
<span class="s">#define ETA(i)   X((1*n_mode + (i)))</span>
<span class="s">#define TAU(i)   X((2*n_mode + (i)))</span>
<span class="s">#define ALPHA(i) X((3*n_mode + (i)))</span>
<span class="s">#define BETA(i)  X((4*n_mode + (i)))</span>
<span class="s">#define GAMMA(i) X((5*n_mode + (i)))</span>

<span class="s">        // aux variables</span>
<span class="s">            , c_0 = I(0)</span>
<span class="s">            , c_1 = I(1)       /* the semicolon --&gt; */  ;  /* don&#39;t forget it */</span>
<span class="s">            </span>
<span class="s">        // modal interactions</span>
<span class="s">#define XI_dot_A(k) (XI(1)*mA(1, (k)) + XI(2)*mA(2, (k)) + XI(3)*mA(3, (k)))</span>
<span class="s">#define XI_dot_C(k) (XI(1)*mC(1, (k)) + XI(2)*mC(2, (k)) + XI(3)*mC(3, (k)))</span>
<span class="s">#define ALPHA_dot_B(k) (ALPHA(1)*mB(1, (k)) + ALPHA(2)*mB(2, (k)) + ALPHA(3)*mB(3, (k)))</span>

<span class="s">        // derivatives</span>
<span class="s">        for (int i=0; i&lt;n_mode; i++)</span>
<span class="s">        {</span>
<span class="s">/* xi */    DX(n_mode*0 + i) = (ETA(i) - vA(i)*XI(i)*XI(i)*XI(i) + vB(i)*XI(i)*XI(i) - TAU(i) + </span><span class="se">\</span>
<span class="s">                               K11 * (XI_dot_A(i) - XI(i)) - </span><span class="se">\</span>
<span class="s">                               K12 * (ALPHA_dot_B(i) - XI(i)) + </span><span class="se">\</span>
<span class="s">                               vIE(i) + c_0);</span>

<span class="s">/* eta */   DX(n_mode*1 + i) = vC(i) - vD(i)*XI(i)*XI(i) - ETA(i);</span>

<span class="s">/* tau */   DX(n_mode*2 + i) = r*s*XI(i) - r*TAU(i) - vM(i);</span>

<span class="s">/* alpha */ DX(n_mode*3 + i) = (BETA(i) - vE(i)*ALPHA(i)*ALPHA(i)*ALPHA(i) + vF(i)*ALPHA(i)*ALPHA(i) - GAMMA(i) +</span><span class="se">\</span>
<span class="s">                                K21 * (XI_dot_C(i) - ALPHA(i)) + </span><span class="se">\</span>
<span class="s">                                vII(i) + c_1);</span>

<span class="s">/* beta */  DX(n_mode*4 + i) = vH(i) - vP(i)*ALPHA(i)*ALPHA(i) - BETA(i);</span>

<span class="s">/* gamma */ DX(n_mode*5 + i) = r*s*ALPHA(i) - r*GAMMA(i) - vN(i);</span>
<span class="s">        }</span>

<span class="s">#undef mA</span>
<span class="s">#undef mB</span>
<span class="s">#undef mC</span>

<span class="s">#undef vA</span>
<span class="s">#undef vB</span>
<span class="s">#undef vC</span>
<span class="s">#undef vD</span>
<span class="s">#undef vE</span>
<span class="s">#undef vF</span>
<span class="s">#undef vH</span>
<span class="s">#undef vP</span>
<span class="s">#undef vIE</span>
<span class="s">#undef vII</span>
<span class="s">#undef vM</span>
<span class="s">#undef vN</span>

<span class="s">#undef XI</span>
<span class="s">#undef ETA   </span>
<span class="s">#undef TAU   </span>
<span class="s">#undef ALPHA </span>
<span class="s">#undef BETA  </span>
<span class="s">#undef GAMMA </span>

<span class="s">#undef XI_dot_A</span>
<span class="s">#undef XI_dot_C</span>
<span class="s">#undef ALPHA_dot_B</span>

<span class="s">&quot;&quot;&quot;</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="JansenRit"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.JansenRit">[docs]</a><span class="k">class</span> <span class="nc">JansenRit</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Jansen and Rit is a biologically inspired mathematical framework</span>
<span class="sd">    originally conceived to simulate the spontaneous electrical activity of</span>
<span class="sd">    neuronal assemblies, with a particular focus on alpha activity, for instance,</span>
<span class="sd">    as measured by EEG. Later on, it was discovered that in addition to alpha</span>
<span class="sd">    activity, this model was also able to simulate evoked potentials.</span>

<span class="sd">    .. [JR_1995]  Jansen, B., H. and Rit V., G., *Electroencephalogram and</span>
<span class="sd">        visual evoked potential generation in a mathematical model of</span>
<span class="sd">        coupled cortical columns*, Biological Cybernetics (73) 357:366, 1995.</span>

<span class="sd">    .. [J_1993] Jansen, B., Zouridakis, G. and Brandt, M., *A</span>
<span class="sd">        neurophysiologically-based mathematical model of flash visual evoked</span>
<span class="sd">        potentials*</span>

<span class="sd">    .. figure :: img/JansenRit_45_mode_0_pplane.svg</span>
<span class="sd">        :alt: Jansen and Rit phase plane (y4, y5)</span>

<span class="sd">        The (:math:`y_4`, :math:`y_5`) phase-plane for the Jansen and Rit model.</span>

<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: JansenRit.__init__</span>
<span class="sd">    .. automethod:: JansenRit.dfun</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Jansen-Rit&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;v0&#39;</span><span class="p">,</span> <span class="s">&#39;nu_max&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;J&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;a_1&#39;</span><span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;a_3&#39;</span><span class="p">,</span> <span class="s">&#39;a_4&#39;</span><span class="p">,</span> <span class="s">&#39;p_min&#39;</span><span class="p">,</span> <span class="s">&#39;p_max&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;mu&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`A`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.25</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">9.75</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum amplitude of EPSP [mV]. Also called average synaptic gain.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`B`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">22.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">17.6</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">110.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum amplitude of IPSP [mV]. Also called average synaptic gain.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Reciprocal of the time constant of passive membrane and all</span>
<span class="s">        other spatially distributed delays in the dendritic network [ms^-1].</span>
<span class="s">        Also called average synaptic time constant.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.075</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Reciprocal of the time constant of passive membrane and all</span>
<span class="s">        other spatially distributed delays in the dendritic network [ms^-1].</span>
<span class="s">        Also called average synaptic time constant.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">v0</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`v_0`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.52</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">3.12</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Firing threshold (PSP) for which a 50</span><span class="si">% f</span><span class="s">iring rate is achieved.</span>
<span class="s">        In other words, it is the value of the average membrane potential</span>
<span class="s">        corresponding to the inflection point of the sigmoid [mV].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">nu_max</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\nu_{max}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0025</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.00125</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.00375</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Determines the maximum firing rate of the neural population</span>
<span class="s">        [s^-1].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`r`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.56</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.28</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Steepness of the sigmoidal transformation [mV^-1].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">J</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`J`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">135.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">65.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1350.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average number of synapses between populations.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">a_1</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_1`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">a_2</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_2`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.8</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">a_3</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_3`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">a_4</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_4`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the slow feedback</span>
<span class="s">        inhibitory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">p_min</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{min}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.12</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Minimum input firing rate.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">p_max</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{max}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.32</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum input firing rate.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\mu_{max}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.22</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Mean input firing rate&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;y0&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
                 <span class="s">&quot;y1&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">500.0</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">]),</span>
                 <span class="s">&quot;y2&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">]),</span>
                 <span class="s">&quot;y3&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]),</span>
                 <span class="s">&quot;y4&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">]),</span>
                 <span class="s">&quot;y5&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">500.0</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;y0&quot;</span><span class="p">,</span> <span class="s">&quot;y1&quot;</span><span class="p">,</span> <span class="s">&quot;y2&quot;</span><span class="p">,</span> <span class="s">&quot;y3&quot;</span><span class="p">,</span> <span class="s">&quot;y4&quot;</span><span class="p">,</span> <span class="s">&quot;y5&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;y0&quot;</span><span class="p">,</span> <span class="s">&quot;y1&quot;</span><span class="p">,</span> <span class="s">&quot;y2&quot;</span><span class="p">,</span> <span class="s">&quot;y3&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`y0 = 0`,</span>
<span class="s">                                    :math:`y1 = 1`, :math:`y2 = 2`, :math:`y3 = 3`, :math:`y4 = 4`, and</span>
<span class="s">                                    :math:`y5 = 5`&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 6.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0, 3], dtype=numpy.int32),</span>
    <span class="c">#        doc = &quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`y0 = 0`,</span>
    <span class="c">#        :math:`y1 = 1`, :math:`y2 = 2`, :math:`y3 = 3`, :math:`y4 = 4`, and</span>
    <span class="c">#        :math:`y5 = 5`&quot;&quot;&quot;,</span>
    <span class="c">#        order = 17)</span>


<div class="viewcode-block" id="JansenRit.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.JansenRit.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise parameters for the Jansen Rit column, [JR_1995]_.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: initing...&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JansenRit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#self._state_variables = [&quot;y0&quot;, &quot;y1&quot;, &quot;y2&quot;, &quot;y3&quot;, &quot;y4&quot;, &quot;y5&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="c">#TODO: adding an update_derived_parameters method to remove some of the</span>
        <span class="c">#      redundant parameter multiplication in dfun should gain about 7%</span>
        <span class="c">#      maybe not worth it... The three exp() kill us at ~90 times *</span>
        <span class="c">#self.nu_max2 = None #2.0 * self.nu_max</span>
        <span class="c">#self.Aa = None # self.A * self.a</span>
        <span class="c">#self.Bb = None # self.B * self.b</span>
        <span class="c">#self.aa = None # self.a**2</span>
        <span class="c">#self.a2 = None # 2.0 * self.a</span>
        <span class="c">#self.b2 = None # 2.0 * self.b</span>
        <span class="c">#self.a_1J = None # self.a_1 * self.J</span>
        <span class="c">#self.a_2J = None # self.a_2 * self.J</span>
        <span class="c">#self.a_3J = None # self.a_3 * self.J</span>
        <span class="c">#self.a_4J = None # self.a_4 * self.J</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="JansenRit.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.JansenRit.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        The dynamic equations were taken from [JR_1995]_</span>

<span class="sd">        .. math::</span>
<span class="sd">            \dot{y_0} &amp;= y_3 \\</span>
<span class="sd">            \dot{y_3} &amp;= A a\,S[y_1 - y_2] - 2a\,y_3 - 2a^2\, y_0 \\</span>
<span class="sd">            \dot{y_1} &amp;= y_4\\</span>
<span class="sd">            \dot{y_4} &amp;= A a \,[p(t) + \alpha_2 J + S[\alpha_1 J\,y_0]+ c_0]</span>
<span class="sd">                        -2a\,y - a^2\,y_1 \\</span>
<span class="sd">            \dot{y_2} &amp;= y_5 \\</span>
<span class="sd">            \dot{y_5} &amp;= B b (\alpha_4 J\, S[\alpha_3 J \,y_0]) - 2 b\, y_5</span>
<span class="sd">                        - b^2\,y_2 \\</span>
<span class="sd">            S[v] &amp;= \frac{2\, \nu_{max}}{1 + \exp^{r(v_0 - v)}}</span>


<span class="sd">        :math:`p(t)` can be any arbitrary function, including white noise or </span>
<span class="sd">        random numbers taken from a uniform distribution, representing a pulse</span>
<span class="sd">        density with an amplitude varying between 120 and 320</span>

<span class="sd">        For Evoked Potentials, a transient component of the input, </span>
<span class="sd">        representing the impulse density attribuable to a brief visual input is </span>
<span class="sd">        applied. Time should be in seconds.</span>

<span class="sd">        .. math::</span>
<span class="sd">            p(t) = q\,(\frac{t}{w})^n \, \exp{-\frac{t}{w}} \\</span>
<span class="sd">            q = 0.5 \\</span>
<span class="sd">            n = 7 \\</span>
<span class="sd">            w = 0.005 [s]</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#NOTE: We could speed up this model by making the number below smaller,</span>
        <span class="c">#      because the exp() dominate runtime, though we&#39;d need to validate</span>
        <span class="c">#      the trade-off in numerical accuracy...</span>
        <span class="n">magic_exp_number</span> <span class="o">=</span> <span class="mi">709</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">lrc</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span>  <span class="n">coupling</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># NOTE: for local couplings</span>
        <span class="c"># 0: pyramidal cells</span>
        <span class="c"># 1: excitatory interneurons</span>
        <span class="c"># 2: inhibitory interneurons</span>
        <span class="c"># 0 -&gt; 1,</span>
        <span class="c"># 0 -&gt; 2,  </span>
        <span class="c"># 1 -&gt; 0,</span>
        <span class="c"># 2 -&gt; 0,</span>

        <span class="c">#p_min = self.p_min</span>
        <span class="c">#p_max = self.p_max</span>
        <span class="c">#p = p_min + (p_max - p_min) * numpy.random.uniform()</span>

        <span class="c">#NOTE: We were getting numerical overflow in the three exp()s below...</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">))</span>
        <span class="n">sigm_y1_y2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">magic_exp_number</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_max</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">y0</span><span class="p">))</span>
        <span class="n">sigm_y0_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">magic_exp_number</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_max</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">y0</span><span class="p">))</span>
        <span class="n">sigm_y0_3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">magic_exp_number</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_max</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>

        <span class="n">dy0</span> <span class="o">=</span> <span class="n">y3</span>
        <span class="n">dy3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">sigm_y1_y2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">y3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y0</span>
        <span class="n">dy1</span> <span class="o">=</span> <span class="n">y4</span>
        <span class="n">dy4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">sigm_y0_1</span> <span class="o">+</span> <span class="n">lrc</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">y4</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y1</span>
        <span class="n">dy2</span> <span class="o">=</span> <span class="n">y5</span>
        <span class="n">dy5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">sigm_y0_3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">y5</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y2</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dy0</span><span class="p">,</span> <span class="n">dy1</span><span class="p">,</span> <span class="n">dy2</span><span class="p">,</span> <span class="n">dy3</span><span class="p">,</span> <span class="n">dy4</span><span class="p">,</span> <span class="n">dy5</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">derivative</span>
</div>
    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>

        <span class="n">pars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;v0&#39;</span><span class="p">,</span> <span class="s">&#39;nu_max&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;J&#39;</span><span class="p">,</span> <span class="s">&#39;a_1&#39;</span><span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;a_3&#39;</span><span class="p">,</span> <span class="s">&#39;a_4&#39;</span><span class="p">,</span>
              <span class="s">&#39;p_min&#39;</span><span class="p">,</span> <span class="s">&#39;p_max&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">],</span>

        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        // read parameters</span>
<span class="s">        float A      = P(0)</span>
<span class="s">            , B      = P(1)</span>
<span class="s">            , a      = P(2)</span>
<span class="s">            , b      = P(3)</span>
<span class="s">            , v0     = P(4)</span>
<span class="s">            , nu_max = P(5)</span>
<span class="s">            , r      = P(6)</span>
<span class="s">            , J      = P(7)</span>
<span class="s">            , a_1    = P(8)</span>
<span class="s">            , a_2    = P(9)</span>
<span class="s">            , a_3    = P(10)</span>
<span class="s">            , a_4    = P(11)</span>
<span class="s">            , p_min  = P(12)</span>
<span class="s">            , p_max  = P(13)</span>
<span class="s">            , mu     = P(14)</span>

<span class="s">        // state variables</span>
<span class="s">            , y0 = X(0)</span>
<span class="s">            , y1 = X(1)</span>
<span class="s">            , y2 = X(2)</span>
<span class="s">            , y3 = X(3)</span>
<span class="s">            , y4 = X(4)</span>
<span class="s">            , y5 = X(5)</span>
<span class="s">            , y6 = X(6)</span>

<span class="s">        // aux variables</span>
<span class="s">            , c_0 = I(0)</span>
<span class="s">            , sigm_y1_y2 = 2.0 * nu_max / (1.0 + exp( r * (v0 - (y1 - y2)) ))</span>
<span class="s">            , sigm_y0_1  = 2.0 * nu_max / (1.0 + exp( r * (v0 - (a_1 * J * y0))))</span>
<span class="s">            , sigm_y0_3  = 2.0 * nu_max / (1.0 + exp( r * (v0 - (a_3 * J * y0))));</span>

<span class="s">        // derivatives</span>
<span class="s">        DX(0) = y3;</span>
<span class="s">        DX(1) = y4;</span>
<span class="s">        DX(2) = y5;</span>
<span class="s">        DX(3) = A * a * sigm_y1_y2 - 2.0 * a * y3 - a*a*y0;</span>
<span class="s">        DX(4) = A * a * (mu + a_2 * J * sigm_y0_1 + c_0) - 2.0 * a * y4 - a*a*y1;</span>
<span class="s">        DX(5) = B * b * (a_4 + J * sigm_y0_3) - 2.0 * b * y5 - b*b*y2;</span>
<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="JRFast"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.JRFast">[docs]</a><span class="k">class</span> <span class="nc">JRFast</span><span class="p">(</span><span class="n">JansenRit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is an optimized version of the above JansenRit model, using numexpr and</span>
<span class="sd">    constant memory (as far as is obvious).</span>

<span class="sd">    Note that it caches parameters and derivative arrays on the first call to</span>
<span class="sd">    the dfun method, so if you change the number of nodes or the parameters, you</span>
<span class="sd">    need to invalidate the cache by setting the invalid_dfun_cache attribute to</span>
<span class="sd">    True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Jansen-Rit-Optimized&quot;</span>

    <span class="n">invalid_dfun_cache</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">#@profile</span>
    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ev</span><span class="o">=</span><span class="n">numexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid_dfun_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfunlocals</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;nu_max&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;v0&#39;</span><span class="p">,</span> <span class="s">&#39;a_1&#39;</span><span class="p">,</span> <span class="s">&#39;J&#39;</span><span class="p">,</span> <span class="s">&#39;a_3&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">,</span> 
                    <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;a_4&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dfunlocals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfunglobals</span> <span class="o">=</span> <span class="p">{}</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">invalid_dfun_cache</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfunlocals</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfunglobals</span>

        <span class="n">l</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;y1&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;y2&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;y3&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;y4&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;y5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

        <span class="n">l</span><span class="p">[</span><span class="s">&#39;c0&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;c1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupling</span>

        <span class="c"># self.cvar = numpy.array([1, 2], dtype=numpy.int32)</span>
        <span class="n">l</span><span class="p">[</span><span class="s">&#39;lc0&#39;</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s">&#39;lc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

        <span class="n">ev</span><span class="p">(</span><span class="s">&#39;A * a * (2.0 * nu_max / (1.0 + exp(r * (v0 - (y1 - y2))))) - 2.0 * a * y3 - a ** 2 * y0&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">casting</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">(</span><span class="s">&#39;A * a * (mu + a_2 * J * (2.0 * nu_max / (1.0 + exp(r * (v0 - (a_1 * J * y0))))) + (c0 - c1) + (lc0 - lc1)) - 2.0 * a * y4 - a ** 2 * y1&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">casting</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">(</span><span class="s">&#39;B * b * (a_4 * J * (2.0 * nu_max / (1.0 + exp(r * (v0 - (a_3 * J * y0)))))) - 2.0 * b * y5 - b ** 2 * y2&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">casting</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>


</div>
<div class="viewcode-block" id="Generic2dOscillator"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Generic2dOscillator">[docs]</a><span class="k">class</span> <span class="nc">Generic2dOscillator</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Generic2dOscillator model is a generic dynamic system with two state</span>
<span class="sd">    variables. The dynamic equations of this model are composed of two ordinary</span>
<span class="sd">    differential equations comprising two nullclines. The first nullcline is a</span>
<span class="sd">    cubic function as it is found in most neuron and population models; the </span>
<span class="sd">    second nullcline is arbitrarily configurable as a polynomial function up to</span>
<span class="sd">    second order. The manipulation of the latter nullcline&#39;s parameters allows</span>
<span class="sd">    to generate a wide range of different behaviors. </span>

<span class="sd">    See:</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">        .. [FH_1961] FitzHugh, R., *Impulses and physiological states in theoretical</span>
<span class="sd">            models of nerve membrane*, Biophysical Journal 1: 445, 1961. </span>
<span class="sd">    </span>
<span class="sd">        .. [Nagumo_1962] Nagumo et.al, *An Active Pulse Transmission Line Simulating</span>
<span class="sd">            Nerve Axon*, Proceedings of the IRE 50: 2061, 1962.</span>
<span class="sd">        </span>
<span class="sd">        .. [SJ_2011] Stefanescu, R., Jirsa, V.K. *Reduced representations of </span>
<span class="sd">            heterogeneous mixed neural networks with synaptic coupling*.  </span>
<span class="sd">            Physical Review E, 83, 2011. </span>

<span class="sd">        .. [SJ_2010]	Jirsa VK, Stefanescu R.  *Neural population modes capture </span>
<span class="sd">            biologically realistic large-scale network dynamics*. Bulletin of </span>
<span class="sd">            Mathematical Biology, 2010.    </span>

<span class="sd">        .. [SJ_2008_a] Stefanescu, R., Jirsa, V.K. *A low dimensional description</span>
<span class="sd">            of globally coupled heterogeneous neural networks of excitatory and</span>
<span class="sd">            inhibitory neurons*. PLoS Computational Biology, 4(11), 2008).</span>


<span class="sd">    The model&#39;s (:math:`V`, :math:`W`) time series and phase-plane its nullclines </span>
<span class="sd">    can be seen in the figure below. </span>

<span class="sd">    The model with its default parameters exhibits FitzHugh-Nagumo like dynamics.</span>

<span class="sd">    +---------------------------+</span>
<span class="sd">    |  EXCITABLE CONFIGURATION  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +==============+============+</span>
<span class="sd">    | a            |     -2.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | b            |    -10.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | c            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | d            |      0.02  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | I            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | * limit cylce if a = 2.0  |</span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    </span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    |   BISTABLE CONFIGURATION  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +==============+============+</span>
<span class="sd">    | a            |      1.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | b            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | c            |     -5.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | d            |      0.02  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | I            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |* monostable regime:       |</span>
<span class="sd">    |* fixed point if Iext=-2.0 |</span>
<span class="sd">    |* limit cylce if Iext=-1.0 |</span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    </span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    |  EXCITABLE CONFIGURATION  |</span>
<span class="sd">    |  (similar to Morris-Lecar)|</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +==============+============+</span>
<span class="sd">    | a            |      0.5   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | b            |      0.6   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | c            |     -4.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | d            |      0.02  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | I            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |* excitable regime if b=0.6|</span>
<span class="sd">    |* oscillatory if b=0.4     |</span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    +---------------------------+     </span>
<span class="sd">    |  SanzLeonetAl  2013       | </span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +==============+============+</span>
<span class="sd">    | a            |    - 0.5   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | b            |    -10.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | c            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | d            |      0.02  |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | I            |      0.0   |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |* excitable regime if      |</span>
<span class="sd">    |* intrinsic frequency is   |</span>
<span class="sd">    |  approx 10 Hz             |</span>
<span class="sd">    +---------------------------+</span>

<span class="sd">    .. figure :: img/Generic2dOscillator_01_mode_0_pplane.svg</span>
<span class="sd">    .. _phase-plane-Generic2D:</span>
<span class="sd">        :alt: Phase plane of the generic 2D population model with (V, W)</span>

<span class="sd">        The (:math:`V`, :math:`W`) phase-plane for the generic 2D population </span>
<span class="sd">        model for default parameters. The dynamical system has an equilibrium </span>
<span class="sd">        point.</span>

<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: Generic2dOscillator.__init__</span>
<span class="sd">    .. automethod:: Generic2dOscillator.dfun</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Generic 2d Oscillator&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;A time-scale hierarchy can be introduced for the state</span>
<span class="s">        variables :math:`V` and :math:`W`. Default parameter is 1, which means</span>
<span class="s">        no time-scale hierarchy.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`I_{ext}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Baseline shift of the cubic nullcline&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Vertical shift of the configurable nullcline&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">10.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Linear slope of the configurable nullcline&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`c`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Parabolic term of the configurable nullcline&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`d`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Temporal scale factor. Warning: do not use it unless</span>
<span class="s">        you know what you are doing and know about time tides.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Coefficient of the quadratic term of the cubic nullcline.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`f`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Coefficient of the cubic term of the cubic nullcline.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`f`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Coefficient of the linear term of the cubic nullcline.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Constant parameter to scale the rate of feedback from the</span>
<span class="s">            slow variable to the fast variable.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\beta`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Constant parameter to scale the rate of feedback from the</span>
<span class="s">            slow variable to itself&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">#Informational attribute, used for phase-plane and initial()</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;V&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]),</span>
                 <span class="s">&quot;W&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">            the expected dynamic range of that state-variable for the current </span>
<span class="s">            parameters, it is used as a mechanism for bounding random initial </span>
<span class="s">            conditions when the simulation isn&#39;t started from an explicit</span>
<span class="s">            history, it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors.&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 2.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0], dtype=numpy.int32),</span>
    <span class="c">#        doc = &quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`V = 0`</span>
    <span class="c">#        and :math:`W = 1`&quot;&quot;&quot;,</span>
    <span class="c">#        order = 7)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="s">&quot;W&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                        monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                        corresponding state-variable indices for this model are :math:`V = 0`</span>
<span class="s">                                        and :math:`W = 1`.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>


<div class="viewcode-block" id="Generic2dOscillator.__init__"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Generic2dOscillator.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        May need to put kwargs back if we can&#39;t get them from trait...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: initing...&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Generic2dOscillator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#self._state_variables = [&quot;V&quot;, &quot;W&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: inited.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Generic2dOscillator.dfun"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Generic2dOscillator.dfun">[docs]</a>    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
             <span class="n">ev</span><span class="o">=</span><span class="n">numexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        The two state variables :math:`V` and :math:`W` are typically considered </span>
<span class="sd">        to represent a function of the neuron&#39;s membrane potential, such as the </span>
<span class="sd">        firing rate or dendritic currents, and a recovery variable, respectively. </span>
<span class="sd">        If there is a time scale hierarchy, then typically :math:`V` is faster </span>
<span class="sd">        than :math:`W` corresponding to a value of :math:`\tau` greater than 1.</span>

<span class="sd">        #TODO: update equations</span>

<span class="sd">        The equations of the generic 2D population model read</span>

<span class="sd">        .. math::</span>
<span class="sd">            \dot{V} &amp;= \tau (\alpha W - V^3 +3 V^2 + I) \\</span>
<span class="sd">            \dot{W} &amp;= (a\, + b\, V + c\, V^2 - \, beta W) / \tau</span>

<span class="sd">        where external currents :math:`I` provide the entry point for local, </span>
<span class="sd">        long-range connectivity and stimulation.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">V</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c">#[State_variables, nodes]</span>
        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>

        <span class="n">lc_0</span> <span class="o">=</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">V</span>


        <span class="c">#if not hasattr(self, &#39;derivative&#39;):</span>
        <span class="c">#    self.derivative = numpy.empty((2,)+V.shape)</span>

        <span class="c">## numexpr       </span>
        <span class="n">dV</span> <span class="o">=</span> <span class="n">ev</span><span class="p">(</span><span class="s">&#39;d * tau * (alpha * W - f * V**3 + e * V**2 + g * V + I + c_0 + lc_0)&#39;</span><span class="p">)</span>
        <span class="n">dW</span> <span class="o">=</span> <span class="n">ev</span><span class="p">(</span><span class="s">&#39;d * (a + b * V + c * V**2 - beta * W) / tau&#39;</span><span class="p">)</span>

        <span class="c">## regular ndarray operation</span>
        <span class="c">##dV = tau * (W - 0.5* V**3.0 + 3.0 * V**2 + I + c_0 + lc_0)</span>
        <span class="c">##dW = d * (a + b * V + c * V**2 - W) / tau</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dV</span><span class="p">,</span> <span class="n">dW</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span>
</div>
    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>
        <span class="n">pars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">],</span>
        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>

<span class="s">        // read parameters</span>
<span class="s">        float tau  = P(0)</span>
<span class="s">            , a    = P(1)</span>
<span class="s">            , b    = P(2)</span>
<span class="s">            , c    = P(3)</span>
<span class="s">            , d    = P(4)</span>
<span class="s">            , I    = P(5)</span>

<span class="s">        // state variables</span>
<span class="s">            , v    = X(0)</span>
<span class="s">            , w    = X(1)</span>

<span class="s">        // aux variables</span>
<span class="s">            , c_0  = I(0)   ;</span>

<span class="s">        // derivatives</span>
<span class="s">        DX(0) = d * (tau * (w - v*v*v + 3.0*v*v + I + c_0));</span>
<span class="s">        DX(1) = d * ((a + b*v + c*v*v - w) / tau);</span>
<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="LileySteynRoss"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.LileySteynRoss">[docs]</a><span class="k">class</span> <span class="nc">LileySteynRoss</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>     
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Liley lumped model as presented in Steyn-Ross et al 1999.</span>

<span class="sd">    This  model is to be use for modelling cortical dynamics in which &quot;inputs&quot;</span>
<span class="sd">    to neuronal assemblies are treated as random Gaussian fluctuations about a</span>
<span class="sd">    mean value. Anesthetic agent effects are modelled as as a modulation of the</span>
<span class="sd">    inhibitory neurotransmitter rate constant.</span>

<span class="sd">    The main state variable is h_e, the average excitatory soma potential,</span>
<span class="sd">    coherent fluctuations of which are believed to be the source of scalp-measured</span>
<span class="sd">    electroencephalogram EEG signals.</span>

<span class="sd">    Parameters are taken from Table 1 [Steyn-Ross_1999]</span>


<span class="sd">    State variables:</span>

<span class="sd">    h_e: exc population mean soma potential [mV]</span>
<span class="sd">    h_i: exc population mean soma potential [mV]</span>

<span class="sd">    I_ee: total &#39;exc&#39; current input to &#39;exc&#39; synapses [mV]</span>
<span class="sd">    I_ie: total &#39;inh&#39; current input to &#39;exc&#39; synapses [mV]</span>
<span class="sd">    I_ei: total &#39;exc&#39; current input to &#39;inh&#39; synapses [mV]</span>
<span class="sd">    I_ii: total &#39;inh&#39; current input to &#39;inh&#39; synapses [mV]</span>

<span class="sd">    :math:`\Psi_{jk}`:  weighting factors for the I_jk inputs [dimensionless]</span>

<span class="sd">    :math:`phi_e`: long-range (cortico-cortical) spike input to exc population</span>
<span class="sd">    :math:`phi_i`: long-range (cortico-cortical) spike input to inh population [ms-1]</span>

<span class="sd">    EPSP: exc post-synaptic potential [mV]</span>
<span class="sd">    IPSP: inh post-synaptic potential [mV]</span>

<span class="sd">    Mean axonal conduction speed: 7 mm/ms</span>

<span class="sd">    S_e(h_e): sigmoid function mapping soma potential to firing rate [ms]-1</span>
<span class="sd">    S_i(h_i): sigmoid function mapping soma potential to firing rate [ms]-1</span>



<span class="sd">    The models (:math:`h_e`, :math:h_i`) phase-plane, including a representation of</span>
<span class="sd">    the vector field as well as its nullclines, using default parameters, can be</span>
<span class="sd">    seen below:</span>

<span class="sd">        .. _phase-plane-LSR:</span>
<span class="sd">        .. figure :: img/LileySteynRoss_01_mode_0_pplane.svg</span>
<span class="sd">            :alt: LileySteynRoss phase plane (E, I)</span>

<span class="sd">            The (:math:`h_e`, :math:`hi`) phase-plane for the LileySteynRoss model.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Liley-SteynRoss model&quot;</span>
    <span class="c">#ui_configurable_parameters = []</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>

    <span class="n">tau_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.00</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory population, membrane time-constant [ms]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">tau_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory population, membrane time-constant [ms]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">h_e_rest</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`h_e^{rest}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">70.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.00</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory population, cell resting potential [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">h_i_rest</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`h_i^{rest}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">70.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory population, cell resting potential [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">h_e_rev</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`h_e^{rev}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">45.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">5.00</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory population, cell reversal potential [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">h_i_rev</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`h_i^{rev}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">90.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Inhibitory population, cell reversal potential [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">43</span><span class="p">)</span>

    <span class="n">p_ee</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{ee}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Exogenous (subcortical) spike input to exc population [ms]-1 [kHz]. </span>
<span class="s">               This could be replaced by a noise term&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">p_ie</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{ie}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.6</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Exogenous (subcortical) spike input to exc population [ms]-1 [kHz]. </span>
<span class="s">               This could be replaced by a noise term&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">p_ei</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{ei}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.6</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Exogenous (subcortical) spike input to inh population [ms]-1 [kHz]. </span>
<span class="s">               This could be replaced by a noise term&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">p_ii</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`p_{ii}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Exogenous (subcortical) spike input to inh population [ms]-1 [kHz]. </span>
<span class="s">               This could be replaced by a noise term&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">A_ee</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_{ee}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Characteristic cortico-cortical inverse length scale [mm]-1. Original: 0.4 cm-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">A_ei</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_{ei}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.065</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Characteristic cortico-cortical inverse length scale [mm]-1. Original: 0.4 cm-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">gamma_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\gamma_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Neurotransmitter rate constant&quot;for EPSP [ms]-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">gamma_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\gamma_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.065</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Neurotransmitter rate constant&quot;for IPSP [ms]-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">G_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`G_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.18</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;peak ampplitude of EPSP [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">G_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`G_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.37</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;peak ampplitude of IPSP [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">N_b_ee</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`N_{ee}^{</span><span class="se">\b</span><span class="s">eta}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3034.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">3000.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">3050.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of local exc to exc synaptic connections.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">N_b_ei</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`N_{ei}^{\beta}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3034.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">3000.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">3050.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of local exc to inh synaptic connections.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">N_b_ie</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`N_{ie}^{\beta}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">536.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">500.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">550.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of local inh to exc synaptic connections.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="n">N_b_ii</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`N_{ii}^{\beta}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">536.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">500.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">550.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of local inh to inh synaptic connections.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>


    <span class="n">N_a_ee</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`N_{ee}^{\alpha}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4000.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">3000.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">5000.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of synaptic connections from distant exc populations&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span>

    <span class="n">N_a_ei</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`N_{ei}^{\alpha}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2000.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">3000.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Total number of synaptic connections from distant exc populations&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">theta_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\theta_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">60.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;inflection point voltage for sigmoid function [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>

    <span class="n">theta_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\theta_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">60.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;inflection point voltage for sigmoid function [mV]&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

    <span class="n">g_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`g_e`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.28</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Sigmoid slope at inflection point exc population [mV]-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

    <span class="n">g_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`g_i`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.14</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Sigmoid slope at inflection point inh population [mV]-1&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>

    <span class="n">lambd</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`\lambda`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Anesthetic effects&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>

    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;he&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">]),</span>
                 <span class="s">&quot;hi&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;he&quot;</span><span class="p">,</span> <span class="s">&quot;hi&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;he&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`E = 0`</span>
<span class="s">                                    and :math:`I = 1`.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Liley Steyn-Ross model&#39;s traited attributes, any provided as</span>
<span class="sd">        keywords will overide their traited default.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: initing...&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LileySteynRoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#self._state_variables = [&quot;E&quot;, &quot;I&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">        TODO:  include equations</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">he</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># long-range coupling - phi_e -&gt; he / phi_e -&gt; h_i</span>
        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c"># short-range (local) coupling - local coupling functions should be different for exc and inh</span>
        <span class="c">#lc_0 = local_coupling * he</span>
        <span class="c">#lc_1 = local_coupling * hi </span>

        <span class="c"># </span>
        <span class="n">psi_ee</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_e_rev</span> <span class="o">-</span> <span class="n">he</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_e_rev</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_e_rest</span><span class="p">)</span> <span class="c"># usually &gt; 0</span>
        <span class="n">psi_ei</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_e_rev</span> <span class="o">-</span> <span class="n">hi</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_e_rev</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_i_rest</span><span class="p">)</span> <span class="c"># usually &gt; 0</span>
        <span class="n">psi_ie</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_i_rev</span> <span class="o">-</span> <span class="n">he</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_i_rev</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_e_rest</span><span class="p">)</span> <span class="c"># usually &lt; 0</span>
        <span class="n">psi_ii</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_i_rev</span> <span class="o">-</span> <span class="n">hi</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_i_rev</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_i_rest</span><span class="p">)</span> <span class="c"># usually &lt; 0</span>


        <span class="n">S_e</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">he</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_e</span><span class="p">)))</span>
        <span class="n">S_i</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">hi</span> <span class="o">+</span> <span class="n">c_0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_i</span><span class="p">)))</span>

        <span class="n">F1</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">h_e_rest</span> <span class="o">-</span> <span class="n">he</span><span class="p">)</span> <span class="o">+</span> <span class="n">psi_ee</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N_a_ee</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_b_ee</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_e</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ee</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_e</span><span class="p">)</span> <span class="o">+</span>\
                                  <span class="bp">self</span><span class="o">.</span><span class="n">lambd</span> <span class="o">*</span> <span class="n">psi_ie</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_b_ie</span> <span class="o">*</span> <span class="n">S_i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ie</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_i</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_i</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span>

        <span class="n">F2</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">h_i_rest</span> <span class="o">-</span> <span class="n">hi</span><span class="p">)</span> <span class="o">+</span> <span class="n">psi_ei</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N_a_ei</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_b_ei</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_e</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ei</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_e</span><span class="p">)</span> <span class="o">+</span>\
                                  <span class="bp">self</span><span class="o">.</span><span class="n">lambd</span> <span class="o">*</span> <span class="n">psi_ii</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_b_ii</span> <span class="o">*</span> <span class="n">S_i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ii</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_i</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_i</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_i</span>





        <span class="n">dhe</span> <span class="o">=</span> <span class="n">F1</span> 
        <span class="n">dhi</span> <span class="o">=</span> <span class="n">F2</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dhe</span><span class="p">,</span> <span class="n">dhi</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">derivative</span>


</div>
<div class="viewcode-block" id="LarterBreakspear"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.LarterBreakspear">[docs]</a><span class="k">class</span> <span class="nc">LarterBreakspear</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A modified Morris-Lecar model that includes a third equation which simulates</span>
<span class="sd">    the effect of a population of inhibitory interneurons synapsing on</span>
<span class="sd">    the pyramidal cells.</span>
<span class="sd">    </span>
<span class="sd">    .. [Larteretal_1999] Larter et.al. *A coupled ordinary differential equation</span>
<span class="sd">        lattice model for the simulation of epileptic seizures.* Chaos. 9(3):</span>
<span class="sd">        795, 1999.</span>
<span class="sd">    </span>
<span class="sd">    .. [Breaksetal_2003_a] Breakspear, M.; Terry, J. R. &amp; Friston, K. J.  *Modulation of excitatory</span>
<span class="sd">        synaptic coupling facilitates synchronization and complex dynamics in an</span>
<span class="sd">        onlinear model of neuronal dynamics*. Neurocomputing 5254 (2003).151158</span>

<span class="sd">    .. [Breaksetal_2003_b] M. J. Breakspear et.al. *Modulation of excitatory </span>
<span class="sd">        synaptic coupling facilitates synchronization and complex dynamics in a</span>
<span class="sd">        biophysical model of neuronal dynamics.* Network: Computation in Neural</span>
<span class="sd">        Systems 14: 703-732, 2003.</span>

<span class="sd">    .. [Honeyetal_2007] Honey, C.; Ktter, R.; Breakspear, M. &amp; Sporns, O. * Network structure of</span>
<span class="sd">        cerebral cortex shapes functional connectivity on multiple time scales*. (2007)</span>
<span class="sd">        PNAS, 104, 10240</span>

<span class="sd">    .. [Honeyetal_2009] Honey, C. J.; Sporns, O.; Cammoun, L.; Gigandet, X.; Thiran, J. P.; Meuli,</span>
<span class="sd">        R. &amp; Hagmann, P. *Predicting human resting-state functional connectivity</span>
<span class="sd">        from structural connectivity.* (2009), PNAS, 106, 2035-2040</span>

<span class="sd">    .. [Alstottetal_2009] Alstott, J.; Breakspear, M.; Hagmann, P.; Cammoun, L. &amp; Sporns, O.</span>
<span class="sd">        *Modeling the impact of lesions in the human brain*. (2009)),  PLoS Comput Biol, 5, e1000408</span>

<span class="sd">    Equations and default parameters are taken from [Breaksetal_2003_b]_. </span>
<span class="sd">    All equations and parameters are non-dimensional and normalized.</span>
<span class="sd">    For values of d_v  &lt; 0.55, the dynamics of a single column settles onto a </span>
<span class="sd">    solitary fixed point attractor.</span>


<span class="sd">    Parameters used for simulations in [Breaksetal_2003_a]_ Table 1. Page 153.</span>
<span class="sd">    Two nodes were coupled.</span>

<span class="sd">    +---------------------------+</span>
<span class="sd">    |          Table 1          | </span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | I            |      0.3   |</span>
<span class="sd">    | a_ee         |      0.4   |</span>
<span class="sd">    | a_ei         |      0.1   |</span>
<span class="sd">    | a_ie         |      1.0   |</span>
<span class="sd">    | a_ne         |      1.0   |</span>
<span class="sd">    | a_ni         |      0.4   |</span>
<span class="sd">    | r_NMDA       |      0.2   |</span>
<span class="sd">    | delta        |      0.001 |</span>
<span class="sd">    +---------------------------+</span>



<span class="sd">    +---------------------------+</span>
<span class="sd">    |          Table 2          | </span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    |Parameter     |  Value     |</span>
<span class="sd">    +--------------+------------+</span>
<span class="sd">    | gK           |      2.0   |</span>
<span class="sd">    | gL           |      0.5   |</span>
<span class="sd">    | gNa          |      6.7   |</span>
<span class="sd">    | gCa          |      1.0   |</span>
<span class="sd">    | a_ne         |      1.0   |</span>
<span class="sd">    | a_ni         |      0.4   |</span>
<span class="sd">    | a_ee         |      0.36  |</span>
<span class="sd">    | a_ei         |      2.0   |</span>
<span class="sd">    | a_ie         |      2.0   |</span>
<span class="sd">    | VK           |     -0.7   |</span>
<span class="sd">    | VL           |     -0.5   |</span>
<span class="sd">    | VNa          |      0.53  |</span>
<span class="sd">    | VCa          |      1.0   |</span>
<span class="sd">    | phi          |      0.7   | </span>
<span class="sd">    | b            |      0.1   |</span>
<span class="sd">    | I            |      0.3   |</span>
<span class="sd">    | r_NMDA       |      0.25  |</span>
<span class="sd">    | C            |      0.1   |</span>
<span class="sd">    | TCa          |     -0.01  |</span>
<span class="sd">    | d_Ca         |      0.15  |</span>
<span class="sd">    | TK           |      0.0   |</span>
<span class="sd">    | d_K          |      0.3   |</span>
<span class="sd">    | VT           |      0.0   |</span>
<span class="sd">    | ZT           |      0.0   |</span>
<span class="sd">    | TNa          |      0.3   |</span>
<span class="sd">    | d_Na         |      0.15  |</span>
<span class="sd">    | d_V          |      0.65  |</span>
<span class="sd">    | d_Z          |      d_V   |  # note, this parameter might be spatialized: ones(N,1).*0.65 + modn*(rand(N,1)-0.5);</span>
<span class="sd">    | QV_max       |      1.0   |</span>
<span class="sd">    | QZ_max       |      1.0   |</span>
<span class="sd">    +---------------------------+</span>
<span class="sd">    |   Alstott et al. 2009     |</span>
<span class="sd">    +---------------------------+</span>


<span class="sd">    NOTES about parameters</span>

<span class="sd">    d_V</span>
<span class="sd">    For d_V &lt; 0.55, uncoupled network, the system exhibits fixed point dynamics; </span>
<span class="sd">    for 55 &lt; lb.d_V &lt; 0.59, limit cycle atractors; </span>
<span class="sd">    and for d_V &gt; 0.59 chaotic attractors (eg, d_V=0.6,aee=0.5,aie=0.5, </span>
<span class="sd">                                               gNa=0, Iext=0.165)</span>

<span class="sd">    C</span>
<span class="sd">    The long-range coupling &#39;C&#39; is weak in the sense that </span>
<span class="sd">    they investigated parameter values for which C &lt; a_ee and C &lt;&lt; a_ie.</span>


<span class="sd">    </span>
<span class="sd">    .. figure :: img/LarterBreakspear_01_mode_0_pplane.svg</span>
<span class="sd">            :alt: Larter-Breaskpear phase plane (V, W)</span>
<span class="sd">            </span>
<span class="sd">            The (:math:`V`, :math:`W`) phase-plane for the Larter-Breakspear model.</span>
<span class="sd">    </span>
<span class="sd">    .. automethod:: __init__</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Larter-Breakspear&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;gCa&#39;</span><span class="p">,</span> <span class="s">&#39;gK&#39;</span><span class="p">,</span> <span class="s">&#39;gL&#39;</span><span class="p">,</span> <span class="s">&#39;phi&#39;</span><span class="p">,</span> <span class="s">&#39;gNa&#39;</span><span class="p">,</span> <span class="s">&#39;TK&#39;</span><span class="p">,</span> <span class="s">&#39;TCa&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;TNa&#39;</span><span class="p">,</span> <span class="s">&#39;VCa&#39;</span><span class="p">,</span> <span class="s">&#39;VK&#39;</span><span class="p">,</span> <span class="s">&#39;VL&#39;</span><span class="p">,</span> <span class="s">&#39;VNa&#39;</span><span class="p">,</span> <span class="s">&#39;d_K&#39;</span><span class="p">,</span> <span class="s">&#39;tau_K&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;d_Na&#39;</span><span class="p">,</span> <span class="s">&#39;d_Ca&#39;</span><span class="p">,</span> <span class="s">&#39;aei&#39;</span><span class="p">,</span> <span class="s">&#39;aie&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;ane&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;ani&#39;</span><span class="p">,</span> <span class="s">&#39;aee&#39;</span><span class="p">,</span> <span class="s">&#39;Iext&#39;</span><span class="p">,</span> <span class="s">&#39;rNMDA&#39;</span><span class="p">,</span> <span class="s">&#39;VT&#39;</span><span class="p">,</span> <span class="s">&#39;d_V&#39;</span><span class="p">,</span> <span class="s">&#39;ZT&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;d_Z&#39;</span><span class="p">,</span> <span class="s">&#39;QV_max&#39;</span><span class="p">,</span> <span class="s">&#39;QZ_max&#39;</span><span class="p">]</span>
    
    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">gCa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`g_{Ca}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Conductance of population of Ca++ channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">gK</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`g_{K}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">1.95</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span> <span class="mf">2.05</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Conductance of population of K channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">gL</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`g_{L}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Conductance of population of leak channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">phi</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\phi`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Temperature scaling factor.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">gNa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`g_{Na}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.7</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Conductance of population of Na channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">TK</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`T_{K}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Threshold value for K channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">TCa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`T_{Ca}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.0025</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;Threshold value for Ca channels.&quot;</span><span class="p">)</span>
    
    <span class="n">TNa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`T_{Na}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;Threshold value for Na channels.&quot;</span><span class="p">)</span>
    
    <span class="n">VCa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`V_{Ca}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Ca Nernst potential.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">VK</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`V_{K}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.7</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;K Nernst potential.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">VL</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`V_{L}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Nernst potential leak channels.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">VNa</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`V_{Na}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.53</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.51</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Na Nernst potential.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">d_K</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\delta_{K}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Variance of K channel threshold.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">tau_K</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\tau_{K}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Time constant for K relaxation time (ms)&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">d_Na</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\delta_{Na}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;Variance of Na channel threshold.&quot;</span><span class="p">)</span>
    
    <span class="n">d_Ca</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\delta_{Ca}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">05.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;Variance of Ca channel threshold.&quot;</span><span class="p">)</span>
    
    <span class="n">aei</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`a_{ei}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Excitatory-to-inhibitory synaptic strength.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">aie</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`a_{ie}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Inhibitory-to-excitatory synaptic strength.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Time constant scaling factor. The original value is 0.1&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">C</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`c`&quot;</span><span class="p">,</span>    
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Strength of excitatory coupling. Balance between internal and</span>
<span class="s">        local (and global) coupling strength. C &gt; 0 introduces interdependences between </span>
<span class="s">        consecutive columns/nodes. C=1 corresponds to maximum coupling.</span>
<span class="s">        This strenght should be set to sensible values when a whole network is connected. &quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">ane</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`a_{ne}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Non-specific-to-excitatory synaptic strength.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">ani</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`a_{ni}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Non-specific-to-inhibitory synaptic strength.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">aee</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`a_{ee}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Excitatory-to-excitatory synaptic strength.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">Iext</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
       <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`I_{ext}`&quot;</span><span class="p">,</span>
       <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]),</span>
       <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.165</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">),</span>
       <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Subcortical input strength. It represents a non-specific</span>
<span class="s">       excitation or thalamic inputs.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">rNMDA</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`r_{NMDA}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Ratio of NMDA to AMPA receptors.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">VT</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`V_{T}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Threshold potential (mean) for excitatory neurons. </span>
<span class="s">        In [Breaksetal_2003_b]_ this values is 0.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">d_V</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\delta_{V}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.65</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.49</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Variance of the excitatory threshold. It is one of the main</span>
<span class="s">        parameters explored in [Breaksetal_2003_b]_.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">ZT</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`Z_{T}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Threshold potential (mean) for inihibtory neurons.&quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">d_Z</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">r&quot;:math:`\delta_{Z}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Variance of the inhibitory threshold.&quot;&quot;&quot;</span><span class="p">)</span>
        
    <span class="c"># NOTE: the values were not in the article. </span>
    <span class="n">QV_max</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`Q_{max}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Maximal firing rate for excitatory populations (kHz)&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">QZ_max</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;:math:`Q_{max}`&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Maximal firing rate for excitatory populations (kHz)&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="s">&quot;Z&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;V&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">        monitored. It can be overridden for each Monitor if desired.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c">#Informational attribute, used for phase-plane and initial()</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;V&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span>
                   <span class="s">&quot;W&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
                   <span class="s">&quot;Z&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])},</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">            the expected dynamic range of that state-variable for the current </span>
<span class="s">            parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">            conditions when the simulation isn&#39;t started from an explicit</span>
<span class="s">            history, it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. May need to put kwargs back if we can&#39;t get them from trait...</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: initing...&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">LarterBreakspear</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="s">&quot;Z&quot;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math::</span>
<span class="sd">             \\dot{V} &amp;= - (g_{Ca} + (1 - C) \\, r_{NMDA} \\, a_{ee} Q_V^i +</span>
<span class="sd">            C \\, r_{NMDA} \\, a_{ee} \\langle Q_V \\rangle) \\, m_{Ca} \\,(V - V_{Ca})</span>
<span class="sd">            - g_K\\, W\\, (V - V_K) - g_L\\, (V - V_L)</span>
<span class="sd">            - (g_{Na} m_{Na} + (1 - C) \\, a_{ee} Q_V^i + </span>
<span class="sd">            C \\, a_{ee} \\langle Q_V \\rangle) \\, (V - V_{Na})</span>
<span class="sd">            - a_{ie}\\, Z \\, Q_Z^i + a_{ne} \\, I_{\\delta}</span>
<span class="sd">            </span>
<span class="sd">            \\dot{W} &amp;= \\frac{\\phi \\, (m_K - W)}{\\tau_K} \\\\</span>
<span class="sd">            \\dot{Z} &amp;= b \\, (a_{ni} \\, I_{\\delta} + a_{ei} \\, V \\, Q_V)\\\\</span>
<span class="sd">            </span>
<span class="sd">            m_{ion}(X) &amp;= 0.5 \\, (1 + tanh(\\frac{V-T_{ion}}{\\delta_{ion}})</span>
<span class="sd">            </span>
<span class="sd">        See Equations (7), (3), (6) and (2) respectively in [Breaksetal_2003]_.</span>
<span class="sd">        Pag: 705-706</span>

<span class="sd">        NOTE: Equation (8) has an error the sign before the term :math:`a_{ie}\\, Z \\, Q_Z^i`</span>
<span class="sd">        should be a minus (-) and not a plus (+).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">c_0</span>   <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>    
        <span class="n">lc_0</span>  <span class="o">=</span> <span class="n">local_coupling</span>
        
        <span class="c"># relationship between membrane voltage and channel conductance</span>
        <span class="n">m_Ca</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">TCa</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_Ca</span><span class="p">))</span>
        <span class="n">m_Na</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">TNa</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_Na</span><span class="p">))</span>
        <span class="n">m_K</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">TK</span> <span class="p">)</span>  <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_K</span><span class="p">))</span>
        
        <span class="c"># voltage to firing rate</span>
        <span class="n">QV</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">QV_max</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">VT</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_V</span><span class="p">))</span>
        <span class="n">QZ</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">QZ_max</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZT</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_Z</span><span class="p">))</span>
        
        <span class="n">dV</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gCa</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rNMDA</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aee</span> <span class="o">*</span> <span class="n">QV</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rNMDA</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aee</span> <span class="o">*</span> <span class="n">c_0</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_Ca</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">VCa</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gK</span> <span class="o">*</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">VK</span><span class="p">)</span> <span class="o">-</span>  <span class="bp">self</span><span class="o">.</span><span class="n">gL</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">VL</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gNa</span> <span class="o">*</span> <span class="n">m_Na</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aee</span> <span class="o">*</span> <span class="n">QV</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aee</span> <span class="o">*</span> <span class="n">c_0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">VNa</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">aei</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">*</span> <span class="n">QZ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ane</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Iext</span><span class="p">)</span>

        <span class="n">dW</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="p">(</span><span class="n">m_K</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_K</span><span class="p">)</span>
        
        <span class="n">dZ</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Iext</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">aei</span> <span class="o">*</span> <span class="n">V</span> <span class="o">*</span> <span class="n">QV</span><span class="p">))</span>
        
        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dV</span><span class="p">,</span> <span class="n">dW</span><span class="p">,</span> <span class="n">dZ</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">derivative</span>


</div>
<div class="viewcode-block" id="ReducedWongWang"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.ReducedWongWang">[docs]</a><span class="k">class</span> <span class="nc">ReducedWongWang</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. [WW_2006] Kong-Fatt Wong and Xiao-Jing Wang,  *A Recurrent Network </span>
<span class="sd">                Mechanism of Time Integration in Perceptual Decisions*. </span>
<span class="sd">                Journal of Neuroscience 26(4), 1314-1328, 2006.</span>

<span class="sd">    .. [DPA_2013] Deco Gustavo, Ponce Alvarez Adrian, Dante Mantini, Gian Luca</span>
<span class="sd">                  Romani, Patric Hagmann and Maurizio Corbetta. *Resting-State</span>
<span class="sd">                  Functional Connectivity Emerges from Structurally and</span>
<span class="sd">                  Dynamically Shaped Slow Linear Fluctuations*. The Journal of</span>
<span class="sd">                  Neuroscience 32(27), 11239-11252, 2013.</span>



<span class="sd">    .. automethod:: __init__</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Reduced Wong-Wang&quot;</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.270</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.270</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot; [nC]^{-1}. Parameter chosen to t numerical solutions.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.108</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;[kHz]. Parameter chosen to t numerical solutions.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`d`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">154.</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">200.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;[ms]. Parameter chosen to t numerical solutions.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">gamma</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\gamma`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.641</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Kinetic parameter&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">tau_s</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\tau_S`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">150.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Kinetic parameter. NMDA decay time constant.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`w`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory recurrence&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">J_N</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`J_{N}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2609</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.2609</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Excitatory recurrence&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">I_o</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`I_{o}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.33</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;[nA] Effective external input&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">sigma_noise</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\sigma_{noise}`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000000001</span><span class="p">,</span> <span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;[nA] Noise amplitude. Take this value into account for stochatic</span>
<span class="s">        integration schemes.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;S&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Population firing rate&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;S&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;S&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;default state variables to be monitored&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label=&quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range=basic.Range(lo=0.0, hi=1.0, step=1.0),</span>
    <span class="c">#        default=numpy.array([0], dtype=numpy.int32),</span>
    <span class="c">#        doc=&quot;default state variables to be monitored&quot;,</span>
    <span class="c">#        order=10)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. May need to put kwargs back if we can&#39;t get them from trait...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#LOG.info(&#39;%s: initing...&#39; % str(self))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedWongWang</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#self._state_variables = [&quot;S1&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReducedWongWang</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_derived_parameters</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Equations taken from [DPA_2013]_ , page 11242</span>

<span class="sd">        ..math:: </span>
<span class="sd">                \frac{dS}{dt} &amp;= -\frac{S}{\tau_s} + (1- S) \, H \, \gamma</span>
<span class="sd">                H(x) &amp;= \frac{ax - b}{1 - \exp(-d(ax -b))}</span>
<span class="sd">                x &amp;= wJ_{N}S + I_o + J_N c_0 + J_N lc_0 </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">S</span>   <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">S</span><span class="p">[</span><span class="n">S</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">S</span><span class="p">[</span><span class="n">S</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">c_0</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        
        <span class="c"># if applicable</span>
        <span class="n">lc_0</span> <span class="o">=</span> <span class="n">local_coupling</span> <span class="o">*</span> <span class="n">S</span>

        <span class="n">x</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_N</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_o</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_N</span> <span class="o">*</span> <span class="n">c_0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_N</span> <span class="o">*</span> <span class="n">lc_0</span>
        <span class="n">H</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)))</span>
        <span class="n">dS</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_s</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dS</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">derivative</span>

</div>
<div class="viewcode-block" id="Kuramoto"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.Kuramoto">[docs]</a><span class="k">class</span> <span class="nc">Kuramoto</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Kuramoto model is a model of synchronization phenomena derived by</span>
<span class="sd">    Yoshiki Kuramoto in 1975 which has since been applied to diverse domains</span>
<span class="sd">    including the study of neuronal oscillations and synchronization.</span>

<span class="sd">    See:</span>

<span class="sd">        .. [YK_1975] Y. Kuramoto, in: H. Arakai (Ed.), International Symposium</span>
<span class="sd">            on Mathematical Problems in Theoretical Physics, Lecture Notes in</span>
<span class="sd">            Physics, page 420, vol. 39, 1975.</span>

<span class="sd">        .. [SS_2000] S. H. Strogatz. *From Kuramoto to Crawford: exploring the</span>
<span class="sd">            onset of synchronization in populations of coupled oscillators*.</span>
<span class="sd">            Physica D, 143, 2000.</span>

<span class="sd">        .. [JC_2011] J. Cabral, E. Hugues, O. Sporns, G. Deco. *Role of local</span>
<span class="sd">            network oscillations in resting-state functional connectivity*.</span>
<span class="sd">            NeuroImage, 57, 1, 2011.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Kuramoto Oscillator&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">]</span>

    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\omega`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;:math:`\omega` sets the base line frequency for the</span>
<span class="s">            Kuramoto oscillator&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">#Informational attribute, used for phase-plane and initial()</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;theta&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">            the expected dynamic range of that state-variable for the current </span>
<span class="s">            parameters, it is used as a mechanism for bounding random initial </span>
<span class="s">            conditions when the simulation isn&#39;t started from an explicit</span>
<span class="s">            history, it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;theta&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;theta&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                            monitored. It can be overridden for each Monitor if desired. The Kuramoto</span>
<span class="s">                            model, however, only has one state variable with and index of 0, so it</span>
<span class="s">                            is not necessary to change the default here.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors.&quot;,</span>
    <span class="c">#        default = numpy.array([0], dtype=numpy.int32),</span>
    <span class="c">#        doc = &quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The Kuramoto</span>
    <span class="c">#        model, however, only has one state variable with and index of 0, so it</span>
    <span class="c">#        is not necessary to change the default here.&quot;&quot;&quot;,</span>
    <span class="c">#        order = 7)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        May need to put kwargs back if we can&#39;t get them from trait...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: initing...&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Kuramoto</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#self._state_variables = [&quot;theta&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: inited.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
             <span class="n">ev</span><span class="o">=</span><span class="n">numexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">,</span> <span class="n">sin</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="n">pi2</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        The :math:`\theta` variable is the phase angle of the oscillation.</span>

<span class="sd">        .. math::</span>
<span class="sd">            \dot{\theta} = \omega + I</span>

<span class="sd">        where :math:`I` is the input via local and long range connectivity, </span>
<span class="sd">        passing first through the Kuramoto coupling function, </span>
<span class="sd">        :py:class:tvb.simulator.coupling.Kuramoto.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># reset if over 2*pi</span>
        <span class="n">state_variables</span><span class="p">[</span><span class="n">state_variables</span> <span class="o">&gt;</span> <span class="n">pi2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">pi2</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>


        <span class="c">#                   TODO CHECKME FIXME ME ME</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">local_coupling</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;derivative&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">theta</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c"># phase update </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">+</span> <span class="n">I</span>

        <span class="c"># all this pi makeh me have great hungary, can has sum NaN?</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span>

    <span class="n">device_info</span> <span class="o">=</span> <span class="n">model_device_info</span><span class="p">(</span>
        <span class="n">pars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">],</span>
        <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        float omega = P(0)</span>
<span class="s">            , theta = X(0)</span>
<span class="s">            , c_0 = I(0) ; </span>

<span class="s">                    // update state array</span>
<span class="s">        if (theta&gt;(2*PI)) X(0)-= 2*PI;</span>

<span class="s">        DX(0) = omega + c_0;</span>

<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="JansenRitDavid"><a class="viewcode-back" href="../../../tvb.simulator.models.html#tvb.simulator.models.JansenRitDavid">[docs]</a><span class="k">class</span> <span class="nc">JansenRitDavid</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Jansen and Rit models as studied by David et al., 2005</span>
<span class="sd">    #TODO: finish this model</span>


<span class="sd">   </span>
<span class="sd">    .. #Currently there seems to be a clash betwen traits and autodoc, autodoc</span>
<span class="sd">    .. #can&#39;t find the methods of the class, the class specific names below get</span>
<span class="sd">    .. #us around this...</span>
<span class="sd">    .. automethod:: JansenRit.__init__</span>
<span class="sd">    .. automethod:: JansenRit.dfun</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ui_name</span> <span class="o">=</span> <span class="s">&quot;Jansen-Rit (David et al., 2005)&quot;</span>
    <span class="n">ui_configurable_parameters</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="c">#Define traited attributes for this model, these represent possible kwargs.</span>
    <span class="n">He</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`He`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.25</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">9.75</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum amplitude of EPSP [mV]. Also called average synaptic gain.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">Hi</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`B`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">29.3</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">17.6</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">110.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Maximum amplitude of IPSP [mV]. Also called average synaptic gain.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">tau_e</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`a`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;time constant&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">tau_i</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`b`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.075</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;time constant&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">eo</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`v_0`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0025</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">3.12</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Firing threshold (PSP) for which a 50</span><span class="si">% f</span><span class="s">iring rate is achieved.</span>
<span class="s">        In other words, it is the value of the average membrane potential</span>
<span class="s">        corresponding to the inflection point of the sigmoid [mV].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


    <span class="n">r</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;:math:`r`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.56</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.28</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Steepness of the sigmoidal transformation [mV^-1].&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>


    <span class="n">gamma_1</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_1`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.0</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">gamma_2</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_2`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">gamma_3</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_3`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the feedback</span>
<span class="s">        excitatory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">gamma_4</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">FloatArray</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">r&quot;:math:`\alpha_4`&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.</span><span class="p">]),</span>
        <span class="nb">range</span><span class="o">=</span><span class="n">basic</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.005</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Average probability of synaptic contacts in the slow feedback</span>
<span class="s">        inhibitory loop.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c">#Used for phase-plane axis ranges and to bound random initial() conditions.</span>
    <span class="n">state_variable_range</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;State Variable ranges [lo, hi]&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;x0&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
                 <span class="s">&quot;x1&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
                 <span class="s">&quot;x2&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),</span>
                 <span class="s">&quot;x3&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]),</span>
                 <span class="s">&quot;x4&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),</span>
                 <span class="s">&quot;x5&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),</span>
                 <span class="s">&quot;x6&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),</span>
                 <span class="s">&quot;x7&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])},</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The values for each state-variable should be set to encompass</span>
<span class="s">        the expected dynamic range of that state-variable for the current </span>
<span class="s">        parameters, it is used as a mechanism for bounding random inital </span>
<span class="s">        conditions when the simulation isn&#39;t started from an explicit history,</span>
<span class="s">        it is also provides the default range of phase-plane plots.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">variables_of_interest</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Enumerate</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">&quot;Variables watched by Monitors&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;x0&quot;</span><span class="p">,</span> <span class="s">&quot;x1&quot;</span><span class="p">,</span> <span class="s">&quot;x2&quot;</span><span class="p">,</span> <span class="s">&quot;x3&quot;</span><span class="p">,</span> <span class="s">&quot;x4&quot;</span><span class="p">,</span> <span class="s">&quot;x5&quot;</span><span class="p">,</span> <span class="s">&quot;x6&quot;</span><span class="p">,</span> <span class="s">&quot;x7&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;x0&quot;</span><span class="p">,</span> <span class="s">&quot;x1&quot;</span><span class="p">,</span> <span class="s">&quot;x2&quot;</span><span class="p">,</span> <span class="s">&quot;x3&quot;</span><span class="p">],</span>
        <span class="n">select_multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
<span class="s">                                    monitored. It can be overridden for each Monitor if desired. The </span>
<span class="s">                                    corresponding state-variable indices for this model are :math:`y0 = 0`,</span>
<span class="s">                                    :math:`y1 = 1`, :math:`y2 = 2`, :math:`y3 = 3`, :math:`y4 = 4`, and</span>
<span class="s">                                    :math:`y5 = 5`&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="c">#    variables_of_interest = arrays.IntegerArray(</span>
    <span class="c">#        label = &quot;Variables watched by Monitors&quot;,</span>
    <span class="c">#        range = basic.Range(lo = 0.0, hi = 6.0, step = 1.0),</span>
    <span class="c">#        default = numpy.array([0, 3], dtype=numpy.int32),</span>
    <span class="c">#        doc = &quot;&quot;&quot;This represents the default state-variables of this Model to be</span>
    <span class="c">#        monitored. It can be overridden for each Monitor if desired. The</span>
    <span class="c">#        corresponding state-variable indices for this model are :math:`y0 = 0`,</span>
    <span class="c">#        :math:`y1 = 1`, :math:`y2 = 2`, :math:`y3 = 3`, :math:`y4 = 4`, and</span>
    <span class="c">#        :math:`y5 = 5`&quot;&quot;&quot;,</span>
    <span class="c">#        order = 17)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise parameters for the Jansen Rit column, [JR_1995]_.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: initing...&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JansenRitDavid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#self._state_variables = [&quot;y0&quot;, &quot;y1&quot;, &quot;y2&quot;, &quot;y3&quot;, &quot;y4&quot;, &quot;y5&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nvar</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cvar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="c">#TODO: adding an update_derived_parameters method to remove some of the</span>
        <span class="c">#      redundant parameter multiplication in dfun should gain about 7%</span>
        <span class="c">#      maybe not worth it... The three exp() kill us at ~90 times *</span>
        <span class="c">#self.nu_max2 = None #2.0 * self.nu_max</span>
        <span class="c">#self.Aa = None # self.A * self.a</span>
        <span class="c">#self.Bb = None # self.B * self.b</span>
        <span class="c">#self.aa = None # self.a**2</span>
        <span class="c">#self.a2 = None # 2.0 * self.a</span>
        <span class="c">#self.b2 = None # 2.0 * self.b</span>
        <span class="c">#self.a_1J = None # self.a_1 * self.J</span>
        <span class="c">#self.a_2J = None # self.a_2 * self.J</span>
        <span class="c">#self.a_3J = None # self.a_3 * self.J</span>
        <span class="c">#self.a_4J = None # self.a_4 * self.J</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: inited.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">dfun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_variables</span><span class="p">,</span> <span class="n">coupling</span><span class="p">,</span> <span class="n">local_coupling</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        The dynamic equations were taken from [JR_1995]_</span>

<span class="sd">        .. math::</span>
<span class="sd">            </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#NOTE: We could speed up this model by making the number below smaller,</span>
        <span class="c">#      because the exp() dominate runtime, though we&#39;d need to validate</span>
        <span class="c">#      the trade-off in numerical accuracy...</span>
        <span class="n">magic_exp_number</span> <span class="o">=</span> <span class="mi">709</span>
        <span class="n">AF</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">AL</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x4</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x5</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x6</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x7</span> <span class="o">=</span> <span class="n">state_variables</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">y</span>   <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span>
        <span class="c">#delayed activity x1 - x2</span>
        <span class="n">c_12</span>   <span class="o">=</span> <span class="n">coupling</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span>  <span class="n">coupling</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> 
        <span class="n">c_12_f</span> <span class="o">=</span> <span class="n">AF</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">c_12</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span>
        <span class="n">c_12_b</span> <span class="o">=</span> <span class="n">AB</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">c_12</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span>
        <span class="n">c_12_l</span> <span class="o">=</span> <span class="n">AL</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">c_12</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span>

        <span class="n">lc_f</span>  <span class="o">=</span> <span class="p">(</span><span class="n">local_coupling</span> <span class="o">*</span>  <span class="n">y</span><span class="p">)</span>  <span class="o">*</span> <span class="n">AF</span>
        <span class="n">lc_l</span>  <span class="o">=</span> <span class="p">(</span><span class="n">local_coupling</span> <span class="o">*</span>  <span class="n">y</span><span class="p">)</span>  <span class="o">*</span> <span class="n">AL</span>
        <span class="n">lc_b</span>  <span class="o">=</span> <span class="p">(</span><span class="n">local_coupling</span> <span class="o">*</span>  <span class="n">y</span><span class="p">)</span>  <span class="o">*</span> <span class="n">AB</span>

        <span class="n">S_y</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span>  <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span>
        <span class="n">S_x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">x0</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span>
        <span class="n">S_x6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">x6</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eo</span>

        <span class="c"># NOTE: for local couplings</span>
        <span class="c"># 0:3 pyramidal cells</span>
        <span class="c"># 1:4 excitatory interneurons</span>
        <span class="c"># 2:5 inhibitory interneurons</span>
        <span class="c"># 3:7 </span>

        <span class="n">dx0</span> <span class="o">=</span> <span class="n">x3</span>
        <span class="n">dx3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">He</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">c_12_f</span> <span class="o">+</span> <span class="n">c_12_l</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_1</span> <span class="o">*</span> <span class="n">S_y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">-</span> <span class="p">(</span><span class="n">x0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dx1</span> <span class="o">=</span> <span class="n">x4</span>
        <span class="n">dx4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">He</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">c_12_b</span> <span class="o">+</span> <span class="n">c_12_l</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_2</span> <span class="o">*</span> <span class="n">S_x0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x4</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">-</span> <span class="p">(</span><span class="n">x1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dx2</span> <span class="o">=</span> <span class="n">x5</span>
        <span class="n">dx5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_4</span> <span class="o">*</span> <span class="n">S_x6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x5</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_i</span> <span class="o">-</span> <span class="p">(</span><span class="n">x2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dx6</span> <span class="o">=</span> <span class="n">x7</span>
        <span class="n">dx7</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">He</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">c_12_b</span> <span class="o">+</span> <span class="n">c_12_l</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_3</span> <span class="o">*</span> <span class="n">S_y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x7</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">-</span> <span class="p">(</span><span class="n">x6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">derivative</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dx0</span><span class="p">,</span> <span class="n">dx1</span><span class="p">,</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">dx3</span><span class="p">,</span> <span class="n">dx4</span><span class="p">,</span> <span class="n">dx5</span><span class="p">,</span> <span class="n">dx6</span><span class="p">,</span> <span class="n">dx7</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">derivative</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/evil_tvb_logo_transparent.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">The Virtual Brain 1.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>