

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TVB Contributors manual &mdash; tvb_doc 2.7 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="tvb_doc 2.7 documentation" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left;  padding: 10px 10px 15px 15px">
<a href="http://www.thevirtualbrain.org/"><img src="_static/logo.svg" height="148" border="0" alt="The Virtual Brain Project"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="web_interface.html">web interface</a>|&nbsp;</li>
	<li><a href="console_interface.html">console interface</a>|&nbsp;</li>
	<li><a href="api.html">API</a>|&nbsp;</li>
	<li><a href="developer.html">Developer</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TVB Contributors manual</a><ul>
<li><a class="reference internal" href="#git-setup">GIT Setup</a></li>
<li><a class="reference internal" href="#contribution-guidelines">Contribution guidelines</a></li>
<li><a class="reference internal" href="#use-tvb-framework-from-console-interface">Use TVB Framework from Console Interface</a><ul>
<li><a class="reference internal" href="#examples-of-using-tvb-console-without-storage-library-profile">Examples of using TVB Console without Storage (Library Profile)</a></li>
<li><a class="reference internal" href="#example-of-using-tvb-console-with-storage-enabled-command-profile">Example of using TVB Console with Storage enabled (Command Profile)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ContributorsManual.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tvb-contributors-manual">
<h1>TVB Contributors manual<a class="headerlink" href="#tvb-contributors-manual" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this document is to provide a step by step flow that will get TVB set-up and ready for code contributions,
and to offer a short tutorial of how TVB can be used from a console script with storage activated as part of TVB framework.
Current document is created and maintained by developers. You should expect changes as the contribution flow evolves.
For details about TVB architecture, please check the adjacent document, or send us an email at <a class="reference external" href="mailto:tvb&#46;admin&#37;&#52;&#48;thevirtualbrain&#46;org">tvb<span>&#46;</span>admin<span>&#64;</span>thevirtualbrain<span>&#46;</span>org</a>.</p>
<div class="section" id="git-setup">
<h2>GIT Setup<a class="headerlink" href="#git-setup" title="Permalink to this headline">¶</a></h2>
<p>The following steps assume you have the latest distribution package from <a class="reference external" href="http://www.thevirtualbrain.org">TVB Web Page</a>. You also need to make sure you have a GIT client installed and available from command line.
You can test this by trying to execute <em>git &#8211;version</em>.</p>
<p>You should access <a class="reference external" href="https://github.com/tvb-admin/tvb_scientific_library">TVB Git Repository</a>. The first step you need to do is to create a free GitHub account, then fork TVB-Library repository for your account.</p>
<div class="figure align-center">
<img alt="_images/fork_repo.jpg" src="_images/fork_repo.jpg" style="width: 90%;" />
<p class="caption">Fork <a class="reference external" href="https://github.com/tvb-admin/tvb_scientific_library">TVB Git Repository</a></p>
</div>
<p>You should now have your own git clone of TVB-Library.</p>
<p>Now, assuming you have your TVB Distribution package unpacked in a folder <em>TVB_Distribution</em>, go into <em>TVB_Distribution/bin</em>.
Depending on the operating system you are using, open a terminal or command line prompt in this directory and then execute the following:</p>
<ul class="simple">
<li>On Unix systems: <em>sh contributor_setup.sh ${github_url}</em></li>
<li>On Windows machines: <em>contributor_setup.bat ${github_url}</em></li>
</ul>
<p>In the commands above replace <em>${github_url}</em> with the URL of your previously forked repository on GitHub.</p>
<div class="figure align-center">
<img alt="_images/clone_repo.jpg" src="_images/clone_repo.jpg" style="width: 90%;" />
<p class="caption">Clone your TVB fork</p>
</div>
<p>The steps above should create a folder <em>TVB_Distribution/scientific_library</em> which contains Simulator, Analyzers, Basic and DataTypes subfolders.
This is a clone of your previously Git forked repository. You are now ready to contribute to TVB. Good luck!</p>
<p>NOTE: Each time you do a clean of TVB using the tvb_clean.sh script, make sure to re-run the above described commands in order to re-initialize TVB_PATH properly. This will give you some GIT related warning which you can just ignore.</p>
</div>
<div class="section" id="contribution-guidelines">
<h2>Contribution guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>By default, the only branch available is &#8216;trunk&#8217;. You should <strong>always</strong> create a separate branch with a self-explanatory name for the new features you want to add to TVB. In order to do this just execute (from <em>TVB_Distribution/scientific_library</em> folder): <em>git checkout {my-awesome-new-feature-url}</em>.</li>
</ul>
<div class="figure align-center">
<img alt="_images/create_branch.jpg" src="_images/create_branch.jpg" style="width: 90%;" />
<p class="caption">Create a new branch within your local cloned repo</p>
</div>
<ul class="simple">
<li>While making your modifications/contributions, make sure that 1) you are working in the right branch and 2) you make pull requests from master (&#8216;trunk&#8217;) often, in order to quickly solve any conflicts which might appear.</li>
<li>If you have problems, send us an email, and we will do our best to help you.</li>
<li>You should put explanatory comments and documentation in your code.</li>
<li>You should attach unit-tests for your new code, to prove that it is correct and that it fits into the overall architecture of TVB.</li>
<li>Once you are done with your changes and you believe that they can be integrated into TVB master repository, go to your GitHub repository, switch to your feature branch and issue a <em>pull request</em>, describing the improvements you did. We will later test that your changes are fit to be included, and notify you of the integration process.</li>
</ul>
</div>
<div class="section" id="use-tvb-framework-from-console-interface">
<h2>Use TVB Framework from Console Interface<a class="headerlink" href="#use-tvb-framework-from-console-interface" title="Permalink to this headline">¶</a></h2>
<p>You can use TVB Framework Distribution package through two different interfaces: one is the web interface
(where you will have an HTML face with buttons and pages for manipulating TVB objects), and the other is through a console interface.</p>
<p>For the second available interface, TVB Distribution package comes with a working IDLE Console which you can use as a low-level alternative to the Web Interface.
In the console interface you can directly play with TVB Python objects and execute the same steps as in the web interface, or more; but you need to have programming knowledge.</p>
<div class="section" id="examples-of-using-tvb-console-without-storage-library-profile">
<h3>Examples of using TVB Console without Storage (Library Profile)<a class="headerlink" href="#examples-of-using-tvb-console-without-storage-library-profile" title="Permalink to this headline">¶</a></h3>
<p>TVB Console can work in two manners: with or without storage enabled. We call the mode with storage enabled <em>Command Profile</em>, and the one without storage <em>Library Profile</em>.
You can fire one of the two profiles, by launching the corresponding command file from inside <em>TVB_Distribution/bin</em>: <em>tvb_command</em> or <em>tvb_library</em></p>
<p>When storage is disabled (in Library Profile), the manipulation of objects is entirely at your hand.
When you close the console any computed data will be lost, unless you store results yourself.</p>
<p>Examples of how TVB Library Profile is in action, are found in folder <em>TVB_Distribution/tvb_scientific_library/tvb/simulator/demos/</em>. Please try them, in the IDLE console of TVB.</p>
<p>Even more details about TVB Library Profile (without storage) are found in file <em>TVB_Distribution/tvb_scientific_library/tvb/simulator/README.txt</em>.</p>
</div>
<div class="section" id="example-of-using-tvb-console-with-storage-enabled-command-profile">
<h3>Example of using TVB Console with Storage enabled (Command Profile)<a class="headerlink" href="#example-of-using-tvb-console-with-storage-enabled-command-profile" title="Permalink to this headline">¶</a></h3>
<p>You can launch TVB Command profile (with File and DB storage enabled) by using <em>tvb_command</em> in <em>bin</em> folder.
An example of what you can further write in the IDLE console which will get fired is placed bellow.</p>
<p>Note that we&#8217;ll use placeholders in the demo script below:</p>
<div class="highlight-python"><pre>$TMP_STORAGE$ = a string representing the path to a folder on your disk that will be used as temporary storage

$ZIP_ATCHIVE_PATH$ = a string representing the path to a ZIP archive on your disk with a valid Connectivity DataType.</pre>
</div>
<p>The following is a demo script for using TVB Command mode for various operations, with storage mode enabled</p>
<div class="highlight-python"><pre>    ## First lines should always be setting use_storage flag to true if you want to persisted data.
    from tvb.basic.profile import TvbProfile as tvb_profile
tvb_profile.set_profile(["-profile", "CONSOLE_PROFILE"])

    ## We need and user and a project. You can initialize your database with
    ## the following. Care this will also reset all the data from your database.
    from tvb.core.services.initializer import reset, initialize
    reset()
    initialize(['tvb.config'])

    ## Import necessary libraries
    import numpy
    from tvb.basic.filters.chain import FilterChain
    from tvb.core.traits import db_events
    from tvb.core.entities import model
    from tvb.core.entities.storage import dao
    from tvb.core.services.operation_service import OperationService
    from tvb.core.adapters.abcadapter import ABCAdapter
    from tvb.simulator import simulator, models, coupling, integrators, monitors, noise

    db_events.attach_db_events()

    ## We need a user and a project in order to run operations and store results
    ## A default user named 'admin' should already exist in the system.
    user = dao.get_user_by_name('admin')
    project = model.Project('my_project_name', user.id)
    project = dao.store_entity(project)

    ##----------------------------------------------------------------------------##
    ##-                      Import a Connectivity ZIP                           -##
    ##----------------------------------------------------------------------------##
    ## Here is an example of how one would launch a TVB uploader:
    tmp_storage = $TMP_STORAGE$
    launcher = OperationService()
    algo_group = dao.find_group('tvb.adapters.uploaders.zip_connectivity_importer', 'ZIPConnectivityImporter')
    adapter = ABCAdapter.build_adapter(algo_group)
    launch_args = {'uploaded' : $ZIP_ATCHIVE_PATH$}
    result = launcher.initiate_operation(user, project.id, adapter, tmp_storage, **launch_args)
    ## You should see as output: "Operation X has finished" where X is the operation ID
    ## You can later on use the Operation ID, to get resulted datatypes if you want.
    op_id = [int(s) for s in result.split() if s.isdigit()][0]

    ## Lets retrieve the result of the upload operation: in this case a Connectivity; and edit an attribute on the Connectivity.
    conn_result = dao.get_results_for_operation(op_id)[0]
    conn_result.subject = "My fancy subject"
    dao.store_entity(conn_result)

    ## We can also retrieve a datatype by specific filters .
    ## E.g. let's get all the connectivities for a specific subject
    from tvb.datatypes.connectivity import Connectivity
    dt_filter = FilterChain(fields = [FilterChain.datatype + '.subject'], operations=["=="], values=['My fancy subject'])
    returned_values = dao.get_values_of_datatype(project.id, Connectivity, dt_filter)
    print "Got from database values: %s" %(returned_values,)

    ##----------------------------------------------------------------------------##
    ##-                      Perform a Simulation                                -##
    ##----------------------------------------------------------------------------##
    ## Configuring: Initialise a Model, Coupling, and Connectivity.
    oscilator = models.Generic2dOscillator(a=1.42)
    ## You can also load a datatype if you have the GID or ID for it.
    white_matter = ABCAdapter.load_entity_by_gid(returned_values[0][2])
    white_matter.speed = numpy.array([4.0])
    white_matter_coupling = coupling.Linear(a=0.016)

    ## Initialise an Integrator
    hiss = noise.Additive(nsig = numpy.array([2**-10,]))
    heunint = integrators.HeunStochastic(dt=0.06103515625, noise=hiss)

    ## Initialise a Monitor with period in physical time
    what_to_watch = monitors.TemporalAverage(period=0.48828125)

    ## Initialise a Simulator -- Model, Connectivity, Integrator, and Monitors.
    sim = simulator.Simulator(model=oscilator, connectivity=white_matter,
                              coupling=white_matter_coupling, integrator=heunint, monitors=what_to_watch)
    sim.configure()
    ## Perform the simulation
    tavg_data = []
    tavg_time = []
    ## Starting simulation
    for tavg in sim(simulation_length=1600):
        if tavg is not None:
            tavg_time.append(tavg[0][0])
            tavg_data.append(tavg[0][1]) ## The first [0] is the first monitor's result

    ##----------------------------------------------------------------------------##
    ##-                      Persist TimeSeries DataType                         -##
    ##----------------------------------------------------------------------------##
    ## At this point the simulation computation is done but data is not yet stored.
    ## We have the data computed, but it's still transient unless we store it in a TimeSeries DataType.
    import tvb.datatypes.time_series as time_series
    data_result = time_series.TimeSeriesRegion()
    ## Need an operation for each datatypes that is to be stored in database. Just use dummy operation here for demo purposes.
    data_result.set_operation_id(1)
    ## A TimeSeries needs a reference to the connectivity that was generated.
    data_result.connectivity = white_matter
    data_result.write_data_slice(tavg_data)
    data_result.write_time_slice(tavg_time)
    data_result.close_file()
    ## Saving simulator result into DB
    dao.store_entity(data_result)
    ## Loading from db to check results are properly stored
    loaded_dt = ABCAdapter.load_entity_by_gid(data_result.gid)
    print "Time shape is %s" % (loaded_dt.get_data_shape('time'),)
    print "Data shape is %s" % (loaded_dt.get_data_shape('data'),)
    print loaded_dt.get_data('time')
    print loaded_dt.get_data('data')</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="web_interface.html">web interface</a>|&nbsp;</li>
	<li><a href="console_interface.html">console interface</a>|&nbsp;</li>
	<li><a href="api.html">API</a>|&nbsp;</li>
	<li><a href="developer.html">Developer</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, timpx.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>